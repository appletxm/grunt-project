var mockPointDetail={code:0,msg:"成功",data:[{type:4,status:1,remark:"预计7天后解锁",patientName:"xx患者",remarkName:"隔壁小王",point:200,amount:"10.00",createdAt:"2015-10-23 18:14:53",skus:[{pid:1e3,skuId:1e4,name:"康泰克",commonName:"美扑伪麻片",salePrice:"10.00",quantity:2,point:200,manufacturer:"中美天津史克制药有限公司"}]}]},pointDetail={ajax:null,messageBox:null,urlParams:{},init:function(){this.ajax=new Ajax,this.messageBox=new MessageBox,this.getUrlParams(),this.getPointDetail()},getUrlParams:function(){this.urlParams=window.location.search.getValueFromUrl(),document.querySelectorAll("title")[0].innerHTML=this.urlParams.point_log},getPointDetail:function(){var a={sendParameters:{}};return this.urlParams.point_id&&""!==this.urlParams.point_id?(a.sendParameters.id=parseInt(this.urlParams.point_id,10),a.url=SYS_VAR.SERVER_ADDRESS+"doc/point_buy_detail/",a.type="GET",a.asyn=!0,a.onSuccess=this.handleGetInfoSuccess.bind(this),a.onError=this.handleGetError.bind(this),this.showLoading(),void this.ajax.send(a)):(this.handleGetError({msg:"积分ID不正确，获取不了积分明细"}),!1)},handleGetInfoSuccess:function(a){if(0===a.code||"0"===a.code){if(a.data&&a.data[0]&&a.data.length>0){var b=a.data[0];this.getDetailHeaderHtml(b),this.getBasicHtml(b),this.getProDetailHtml(b),this.hideLoading()}}else this.handleGetError(a)},getDetailHeaderHtml:function(a){var b=[],c=document.querySelector("#headInfo"),d=a.point;d=d&&""!==d&&"unll"!==d&&"undefined"!==d?"+"+d:0,b.push('<b class="price">'+d+"</b>"),b.push("<span>"+(a.remark||"")+"</span>"),b.push("<i>"+(this.urlParams.point_log||"")+"</i>"),b.push('<p class="c"></p>'),c.innerHTML=b.join("")},getBasicHtml:function(a){var b=[],c=document.querySelector("#basicSection");b.push("<dl>"),b.push("<dt>发生时间</dt>"),b.push("<dd>"+(a.createdAt||"")+"</dd>"),b.push("</dl>"),b.push("<dl>"),b.push("<dt>商品总额</dt>"),b.push('<dd class="price">'+(a.amount?"￥"+a.amount:"")+" </dd>"),b.push("</dl>"),b.push("<dl>"),b.push("<dt>积分来源</dt>"),b.push("<dd>"+(this.urlParams.point_log||"")+"</dd>"),b.push("</dl>"),b.push("<dl>"),b.push("<dt>患者姓名</dt>"),b.push("<dd>"+(a.remarkName||a.patientName)+"</dd>"),b.push("</dl>"),c.innerHTML=b.join("")},getProDetailHtml:function(a){var b=[],c=document.querySelector("#proDetail"),d=a.skus||[];b.push("<h1>商品详情</h1>"),d.forEach(function(a){var c=a.name,d=a.salePrice;a.commonName&&""!==a.commonName&&"unll"!==a.commonName&&"undefined"!==a.commonName&&(c=c+"("+a.commonName+")"),a.quantity&&""!==a.quantity&&(c=c+"X"+a.quantity),d&&""!==d&&"unll"!==d&&"undefined"!==d&&(d="￥"+d),b.push("<dl>"),b.push('<dt><span class="point-flag">'+(a.point||0)+"</span></dt>"),b.push("<dd>"),b.push("<b>"+c+"</b>"),b.push("<i>"+(a.manufacturer||"")+"</i>"),b.push('<i>商品金额：<em class="price">'+d+"</em></i>"),b.push("</dd>"),b.push("</dl>")}),c.innerHTML=b.join("")},handleGetError:function(a){var b=a.msg;b&&""!==b||(b="网络异常，请稍后再试"),this.messageBox.show({msg:b,type:"alert",autoClose:!0})},showLoading:function(){this.messageBox.show({msg:'<span class="fa fa-spinner fa-pulse fa-2x fa-fw"></span>',type:"loading",autoClose:!1})},hideLoading:function(){this.messageBox.hide()}};pointDetail.init();