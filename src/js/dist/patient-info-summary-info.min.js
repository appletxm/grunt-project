"use strict";var mockPatientDetail={data:[{patientId:10,phone:"11111112222",name:"刘德华",remarkName:"隔壁小王",age:30,gender:"男",maritalStatus:"未婚",weight:68,height:186,city:"广东湛江坡头区",smokeHistory:"日吸烟量：平均2支;开始吸烟年龄：18;吸烟状态：吸烟",pastDisease:"过往1,过往6,测试其他",hereditaryDisease:"遗传3,遗传4,测试其他",familyHistory:"父亲：家族2,家族21,家族22,其他病史1;母亲：家族5,家族22,其他病史2;兄弟姐妹：家族11,家族22,其他病史3;子女：家族22,其他病史4;",drinkHstory:"饮酒频率：偶尔;日饮酒量：123两;已戒酒，戒酒年龄2岁;饮酒种类：啤酒,红酒,洋酒,其他酒",medicationAllergy:"过敏7,过敏8,其他过敏",headUrl:""}],msg:"success",code:0},mockDisturb={code:0,msg:"成功",data:[{users:[1,3,4,52393]}]},mockSetOk={code:0,msg:"成功",data:[]},patientInfoNew={server:SYS_VAR.SERVER_ADDRESS,messageBox:null,ajax:null,setTopMsgCheck:null,setNoDisturbCheck:null,urlParams:{},patientId:null,requestUrl:SYS_VAR.SERVER_ADDRESS,init:function(){this.messageBox=new MessageBox,this.ajax=new Ajax,this.setTopMsgCheck=new AnimateCheck,this.setNoDisturbCheck=new AnimateCheck,this.setTopMsgCheck.init({bindObj:document.querySelector("#setTopMsg"),callBack:this.setMessagesTop.bind(this)}),this.setNoDisturbCheck.init({bindObj:document.querySelector("#setNoDisturb"),callBack:this.setMessagesDisturb.bind(this)}),this.showLoading(),this.getParamsFromUrl(),this.getPatientDetail()},getParamsFromUrl:function(){var a=window.location.search;this.urlParams=a.getValueFromUrl(),window.localStorage.setItem("patientInfo",encodeURIComponent(JSON.stringify(this.urlParams))),this.setOpenChatButton()},getPatientDetail:function(){var a={sendParameters:{patientId:parseInt(this.urlParams.patient_id,10)}},b="doc/patient_detail/",c=this.getPatientDetailSuccess;this.doRequest(b,a,c)},doRequest:function(a,b,c){var d=b;d.url=this.requestUrl+a,d.type="GET",d.asyn=!0,d.onSuccess=c.bind(this),d.onError=this.handleGetError.bind(this),this.ajax.send(d)},getPatientDetailSuccess:function(a){this.setPatientInfo(a),this.getMessagesTop()},setPatientInfo:function(a){var b,c,d,e=document.querySelector("#patientBaseInfo"),f=[];if(0===a.code||"0"===a.code){if(b=a.data[0],!b)return this.handleGetError({msg:"获取患者详情失败，请稍后再试。"}),!1;c=b.headUrl&&""!==b.headUrl&&"null"!==b.headUrl&&"undefined"!==b.headUrl?b.headUrl:"../../styles/images/patient_default.png",d=b.remarkName||b.name,f.push('<a href="patient-info-base.html?patient_id='+b.patientId+'">'),f.push('<div class="patient-photo">'),f.push('<img id="headUrl" src="'+c+'?s=t" width="100" />'),f.push("</div>"),f.push("<p>"),f.push('<span id="name">'+d+"</span>"),f.push('<samll id="city">'+b.city+"</samll>"),f.push("</p>"),f.push("</a>"),document.querySelector("#name-note").innerHTML=d,document.querySelector("#noto-name").setAttribute("href","patient-info-name-note.html?patient_id="+b.patientId+"&remark_name="+encodeURIComponent(d)),document.querySelector("#patient-case-files").setAttribute("href","patient-case-files.html?patient_id="+b.patientId),document.querySelector("#patient-chat-images").setAttribute("href","patient-chat-images.html?patient_id="+b.patientId),document.querySelector("#patient-illness-note").setAttribute("href","patient-illness-note.html?patient_id="+b.patientId)}e.innerHTML=f.join("")},getMessagesTop:function(){var a,b="doc/msg_top/",c={sendParameters:{}};a=function(a){this.handleGetStatusSuccess(a,this.setTopMsgCheck,"top")},this.doRequest(b,c,a)},setMessagesTop:function(){var a,b,c="doc/msg_top_set/",d=this.setTopMsgCheck.param.bindObj,e={sendParameters:{}};a=d.querySelectorAll("input")[0],e.sendParameters.topId=parseInt(this.urlParams.patient_id,10),e.sendParameters.operate=parseInt(a.value,10),b=function(a){this.handleSetStatusSuccess(a,this.setTopMsgCheck)},this.showLoading(),this.doRequest(c,e,b)},getMessagesDisturb:function(){var a,b="doc/shield/",c={sendParameters:{}};a=function(a){this.handleGetStatusSuccess(a,this.setNoDisturbCheck,"disturb")},this.doRequest(b,c,a)},setMessagesDisturb:function(){var a,b,c="doc/shield_set/",d=this.setNoDisturbCheck.param.bindObj,e={sendParameters:{}};a=d.querySelectorAll("input")[0],e.sendParameters.shieldId=parseInt(this.urlParams.patient_id,10),e.sendParameters.operate=parseInt(a.value,10),b=function(a){this.handleSetStatusSuccess(a,this.setNoDisturbCheck)},this.showLoading(),this.doRequest(c,e,b)},handleGetStatusSuccess:function(a,b,c){var d=!1;0===a.code||"0"===a.code?(d=this.checkPatientHasInTheList(a.data?a.data[0]:{}),this.toggleCheck(b,d,d?1:0,!0),"disturb"===c&&this.hideLoading()):this.handleGetError(a),"disturb"!==c&&this.getMessagesDisturb()},handleSetStatusSuccess:function(a,b){0===a.code||"0"===a.code?this.hideLoading():(this.handleGetError(a),this.reSetCheck(b))},checkPatientHasInTheList:function(a){var b=!1;if(a&&a.users){var c=a.users;c.toString().indexOf(this.urlParams.patient_id)>=0&&(b=!0)}return b},toggleCheck:function(a,b,c,d){a.toggleCheck(b,c,d)},setOpenChatButton:function(){var a=this.urlParams,b="../chat/chat.html",c=document.querySelectorAll("footer")[0];b+="?patient_id="+encodeURIComponent(a.patient_id),b+="&patient_name="+encodeURIComponent(a.patient_name),b+="&patient_icon="+encodeURIComponent(a.patient_icon),b+="&doctor_id="+encodeURIComponent(a.doctor_id),c.innerHTML='<a href="'+b+'">发送消息</a>'},handleGetError:function(a){var b=a.msg;""!==b&&b||(b="网络异常，请稍后再试"),this.messageBox.show({msg:b,type:"alert",autoClose:!0})},reSetCheck:function(a){var b=a.param.bindObj,c=parseInt(b.querySelectorAll("input")[0],10),d=!1;1===c?c=0:(c=1,d=!0),this.toggleCheck(a,d,c,!0)},showLoading:function(){this.messageBox.show({msg:'<span class="fa fa-spinner fa-pulse fa-2x fa-fw"></span>',type:"loading",autoClose:!1})},hideLoading:function(){this.messageBox.hide()}};patientInfoNew.init();