var userAuthData={code:0,msg:"",data:[{authStatus:2}]},bankListData={code:0,msg:"",data:[{userBankId:"0001",bankName:"农行",shortNum:"6788"},{userBankId:"0001",bankName:"农行",shortNum:"6788"}]},pointCard={ajax:null,messageBox:null,popWindow:null,removeCardList:[],authStatus:4,init:function(){this.ajax=new Ajax,this.messageBox=new MessageBox,this.popWindow=new PopWindow,this.attachEvent(),this.checkUserAuthData()},checkUserAuthData:function(){var a={sendParameters:{}};a.url=SYS_VAR.SERVER_ADDRESS+"doc/user_auth_data/",a.type="GET",a.asyn=!0,a.onSuccess=this.handleGetAuthDataSuccess.bind(this),a.onError=this.handleGetAuthDataError.bind(this),a.mssage=this.messageBox,this.ajax.send(a)},handleGetAuthDataSuccess:function(a){0===a.code||"0"===a.code?(this.authStatus=parseInt(a.data[0].authStatus,10),this.getCardList()):this.handleGetAuthDataError()},handleGetAuthDataError:function(){this.authStatus=4,this.getCardList()},getCardList:function(){var a={sendParameters:{}};a.url=SYS_VAR.SERVER_ADDRESS+"doc/query_banks/",a.type="GET",a.asyn=!0,a.onSuccess=this.handleGetCardSuccess.bind(this),a.onError=this.handleGetCardError.bind(this),a.mssage=this.messageBox,this.ajax.send(a)},handleGetCardSuccess:function(a){if(0===a.code){var b=a.data,c=document.querySelector("#deleteSelectedCard"),d=document.querySelectorAll(".my-card ul")[0],e=document.querySelectorAll(".no-data-tip")[0],f=document.querySelectorAll("footer")[0];if(f.style.display="block",b.length<=0)return c.style.display="none",e.style.display="block",!1;c.style.display="block",e.style.display="none";for(var g=0,h="";g<b.length;g++)h=h+'<li forId="'+b[g].userBankId+'">'+b[g].bankName+"（<i>尾号为"+b[g].shortNum+"</i>）</li>";d.innerHTML=h}else this.handleGetCardError(a)},handleGetCardError:function(a){this.handleAllError(a)},handleDeleteCardSuccess:function(){window.location.reload()},handleDeleteCardError:function(a){this.handleAllError(a),this.popWindow.hide()},handleAllError:function(a){var b=a.msg;b&&""!==b||(b="网络异常，请稍后再试"),this.messageBox.show({msg:b,type:"alert",autoClose:!0})},handleClick:function(a){a.stopPropagation(),"li"===a.target.tagName.toLowerCase()?(this.toggleSelected(a),a.preventDefault()):"a"===a.target.tagName.toLowerCase()},toggleSelected:function(a){var b=a.target,c=b.className,d=0;if(c&&c.indexOf("row-check")>=0)for(b.className="";d<this.removeCardList.length;d++)this.removeCardList[d]===b.getAttribute("forid")&&this.removeCardList.splice(d,1);else b.className="row-check",this.removeCardList.push(b.getAttribute("forid"))},deleteSelectedCard:function(){var a=this.removeCardList;a.length<=0?this.messageBox.show({msg:"请选择要删除的银行卡？",type:"alert",autoClose:!0}):this.showDeleteConfirm()},showDeleteConfirm:function(){var a={buttons:[],space:{}};a.needMask=!0,a.content='<div class="tip-msg-fixed">确认要删除？</div>',a.title="温馨提示",a.space={height:80},a.buttons.push({text:"确认",css:"save x2",callback:"pointCard.doDeleteCard()"},{text:"取 消",css:"cancel x2",callback:"pointCard.cancelDelete()"}),this.popWindow.show(a)},doDeleteCard:function(a){a=this.removeCardList;var b={sendParameters:{del_Banks:a.join(",")}};b.url=SYS_VAR.SERVER_ADDRESS+"doc/del_banks/",b.type="GET",b.asyn=!0,b.onSuccess=pointCard.handleDeleteCardSuccess.bind(this),b.onError=pointCard.handleDeleteCardError.bind(this),b.mssage=this.messageBox,this.popWindow.popWindow.querySelectorAll(".container")[0].style.display="none",this.ajax.send(b)},cancelDelete:function(){this.popWindow.hide()},doAddCard:function(a){},attachEvent:function(){var a=document.querySelectorAll(".my-card")[0],b=document.querySelector("#deleteSelectedCard"),c=document.querySelector("#addBankCard");a.addEventListener("click",function(a){this.handleClick(a)}.bind(this)),b.addEventListener("click",function(){this.deleteSelectedCard()}.bind(this)),c.addEventListener("click",function(a){this.doAddCard(a)}.bind(this))}};pointCard.init();