"use strict";var mockData={data:[{id:1107,name:"【999】三九感冒灵胶囊 12粒",commonName:"感冒灵胶囊",spec:"6g装",usage:"口服，一次2粒，一日3次。",image:"http://img.jxdyf.com/product/0000/011/11632_L1.jpg",salePrice:"10.90",marketPrice:"13.08",addNum:0,added:!1,skus:[{skuId:15511,name:"999感冒灵胶囊",salePrice:"10.90",prescribed:!1}],prescribed:!1},{id:1108,name:"【999】三九感冒灵胶囊 12粒",commonName:"感冒灵胶囊",spec:"6g装",usage:"口服，一次2粒，一日3次。",image:"http://img.jxdyf.com/product/0000/011/11632_L1.jpg",salePrice:"10.90",marketPrice:"13.08",addNum:0,added:!1,skus:[{skuId:15511,name:"999感冒灵胶囊",salePrice:"10.90",prescribed:!1}],prescribed:!1}],msg:"成功",code:0},mockPrescriptionData={data:[{id:3,doctorId:1,name:"分组",medicationIds:"16495,10049,7044",createdAt:"2015-06-23 23:24:48",changedAt:null}],msg:"success",code:0},mockResult={data:[],msg:"成功",code:0},presctiptionsList={ajax:null,messageBox:null,goodsDelID:[],flagID:null,groupID:null,getIdsFromData:[],title:null,init:function(){this.messageBox=new MessageBox,this.ajax=new Ajax,this.getNameAjax=new Ajax,this.getURLparameter(),this.styleRevise(),this.attachEvent(),this.getPrescriptionName(),this.getPresctiptionsDrugList()},getPrescriptionName:function(){var a,b=parseInt(this.flagID,10),c=this;return 1!==b?!1:(a={url:SYS_VAR.SERVER_ADDRESS+"doc/medication_group_list/",type:"GET",asyn:!0,onSuccess:c.getPrescriptionSuccess.bind(c),onError:c.handleError.bind(c),sendParameters:{}},void c.getNameAjax.send(a))},getPrescriptionSuccess:function(a){var b,c=this;(0===a.code||"0"===a.code)&&(b=a.data,console.info(b)),b&&b.length>0&&b.forEach(function(a){a.id===parseInt(c.groupID,10)&&(c.title=a.name,document.querySelector("#rename-box input").value=c.title)})},getURLparameter:function(){var a=window.location.search,b=a.getValueFromUrl();this.flagID=b.flag,this.groupID=b.group_id,(0===this.flagID||"0"===this.flagID)&&(this.title="常用药",document.querySelector("#rename-box input").value=this.title)},styleRevise:function(){var a=document.querySelector("#rename-box input");(0===this.flagID||"0"===this.flagID)&&a.setAttribute("readOnly","readOnly"),this.showLoading()},getPresctiptionsDrugList:function(){var a=parseInt(this.flagID,10),b=this,c={url:SYS_VAR.SERVER_ADDRESS+(1===a?"doc/medication_group_detail/":"doc/medication_box/"),type:"GET",asyn:!0,onSuccess:b.handleGetInfoSuccess.bind(b),onError:b.handleError.bind(b),sendParameters:{}};1===a?c.sendParameters.id=b.groupID:(c.sendParameters.page=1,c.sendParameters.num=500),b.ajax.send(c)},handleGetInfoSuccess:function(a){var b=[],c=this,d=parseInt(this.flagID,10);b.push(document.querySelector("#prescriptions-drug-list ul").innerHTML?document.querySelector("#prescriptions-drug-list ul").innerHTML:""),1===d?a.data.length>0?a.data.forEach(function(a){b.push("<li>"),b.push('<div class="left-img-box">'),b.push('<a href="../medical/medical-detail.html?medicalId='+a.id+"&isAdded="+a.added+'">'),b.push('<img src="'+a.image+'?s=t" width="80" />'),b.push("</a></div>"),b.push('<div class="right-info-box">'),b.push('<p class="nowrap title">'+a.name+"</p>"),b.push('<p class="nowrap">'+a.commonName+"</p>"),b.push("<p><b>&yen;"+a.salePrice+"</b></p>"),b.push("</div>"),b.push('<i class="del-goods" data-id="'+a.id+'"></i>'),b.push("</li>"),c.getIdsFromData.push(a.id)}):b.push("<li>暂无药品哦！</li>"):a.data.length>0?a.data[0].voList.forEach(function(a){b.push("<li>"),b.push('<div class="left-img-box">'),b.push('<a href="../medical/medical-detail.html?medicalId='+a.id+'&isAdded=true">'),b.push('<img src="'+a.image+'?s=t" />'),b.push("</a></div>"),b.push('<div class="right-info-box">'),b.push('<p class="nowrap title">'+a.name+"</p>"),b.push('<p class="nowrap">'+a.commonName+"</p>"),b.push("<p><b>&yen;"+a.salePrice+"</b></p>"),b.push("</div>"),b.push('<i class="del-goods" data-id="'+a.id+'"></i>'),b.push("</li>"),c.getIdsFromData.push(a.id)}):b.push("<li>暂无药品哦！</li>"),this.medicationIds=this.getIdsFromData.toString(),document.querySelector("#prescriptions-drug-list ul").innerHTML=b.join(""),this.hideLoading()},handleError:function(a){var b=a.msg;b&&""!==b||(b="网络异常，请稍后重试"),this.messageBox.show({msg:b,type:"alert",autoClose:!0}),this.goodsDelID=[]},saveEditList:function(a){for(var b=document.querySelectorAll("#prescriptions-drug-list li i"),c=document.querySelectorAll(".btn-group"),d=0;d<b.length;d++)b[d].style.display="none";this.goodsDelID.length>0&&this.doSaveDelGoods(),c[0].style.display="block",c[1].style.display="none",a.stopPropagation()},delGoods:function(a){var b,c=document.querySelectorAll("#prescriptions-drug-list li i");if(0===c.length)return!1;for(var d=0;d<c.length;d++)c[d].style.display="block";b=document.querySelectorAll(".btn-group"),b[0].style.display="none",b[1].style.display="block",a.stopPropagation()},listDelBtn:function(a){var b;if(a.target&&"I"===a.target.nodeName){var c=a.target.getAttribute("data-id"),d=a.target.parentNode;d.parentNode.removeChild(d),b=new RegExp(""+c+"\\,?","g"),this.medicationIds=this.medicationIds.replace(b,"")}0===this.flagID||"0"===this.flagID?this.doDelCyDrug(c):c&&this.goodsDelID.push(c)},addGoods:function(){var a="../prescriptions/prescriptions-search.html";a+="?group_id="+this.groupID,a+="&flag="+this.flagID,a+="&group_name="+encodeURIComponent(this.title),a+="&medication_ids="+encodeURIComponent(this.medicationIds),window.location.href=a},doDelCyDrug:function(a){var b=this,c={url:SYS_VAR.SERVER_ADDRESS+"doc/medication_remove_box/",type:"GET",asyn:!0,onSuccess:b.handleSaveDelSuccess.bind(b),onError:b.handleDelError.bind(b),sendParameters:{pid:a}};b.ajax.send(c)},doSaveDelGoods:function(){var a,b=this;a={url:SYS_VAR.SERVER_ADDRESS+"doc/medication_group_remove_medic/",type:"GET",asyn:!0,onSuccess:b.handleSaveDelSuccess.bind(b),onError:b.handleDelError.bind(b),sendParameters:{id:b.groupID,medicationIds:b.goodsDelID.join()}},b.ajax.send(a)},handleSaveDelSuccess:function(a){"0"===a.code||0===a.code?(this.messageBox.show({msg:"保存成功！",type:"alert",autoClose:!0}),this.goodsDelID=[]):this.handleDelError(a)},handleDelError:function(a){var b=a.msg;b&&""!==b||(b="网络异常，请稍后重试"),this.messageBox.show({msg:b,type:"alert",autoClose:!0}),setTimeout(function(){window.location.reload()},500)},saveNameFuc:function(a){var b,c=a.target.value,d=this;return""===c?(this.messageBox.show({msg:"处方单名称不能为空！",type:"alert",autoClose:!0}),!1):(b={url:SYS_VAR.SERVER_ADDRESS+"doc/medication_group_modify/",type:"GET",asyn:!0,onSuccess:d.handleSaveNameSuccess.bind(d),onError:d.handleError.bind(d),sendParameters:{id:d.groupID,name:c}},void d.ajax.send(b))},handleSaveNameSuccess:function(a){"0"===a.code||0===a.code?(this.messageBox.show({msg:"保存成功！",type:"alert",autoClose:!0}),this.title=document.querySelector("#rename-box input").value):this.handleDelError(a)},showLoading:function(){this.messageBox.show({msg:'<span class="fa fa-spinner fa-pulse fa-2x fa-fw"></span>',type:"loading",autoClose:!1})},hideLoading:function(){this.messageBox.hide()},attachEvent:function(){var a=document.querySelector("#del"),b=document.querySelector("#add"),c=document.querySelector("#save"),d=document.querySelector("#prescriptions-drug-list ul"),e=document.querySelector("#rename-box input"),f=parseInt(this.flagID,10);a.addEventListener("click",function(a){this.delGoods(a)}.bind(this)),b.addEventListener("click",this.addGoods.bind(this)),c.addEventListener("click",this.saveEditList.bind(this)),d.addEventListener("click",this.listDelBtn.bind(this)),0!==f&&e.addEventListener("blur",this.saveNameFuc.bind(this))}};presctiptionsList.init();