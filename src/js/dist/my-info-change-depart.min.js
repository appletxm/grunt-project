"use strict";var mockDepartData={code:0,msg:"成功",data:[{departmentList:[{parentId:1,departName:"肿瘤内科大一",departId:8},{parentId:1,departName:"肿瘤内科大二",departId:9,secondDepart:[{id:90,name:"感染内科一",parentId:9},{id:91,name:"感染内科二",parentId:9}]},{parentId:null,departName:"很长的一个科室名称很长很长",departId:6}]}]},myInfoChangeDepart={ajax:null,messageBox:null,popWindow:null,searchFromCache:null,departmentList:[],departmentCacheList:[],selectedDepartId:null,init:function(){this.ajax=new Ajax,this.messageBox=new MessageBox,this.popWindow=new PopWindow,this.searchFromCache=new SearchFromCache,this.attachEvent(),this.getDepartList()},getDepartList:function(){var a={sendParameters:{}};a.url=SYS_VAR.SERVER_ADDRESS+"doc/department_and_title/",a.type="GET",a.asyn=!0,a.onSuccess=this.handleGetLevelSuccess.bind(this),a.onError=this.handleError.bind(this),a.mssage=this.messageBox,this.ajax.send(a)},handleGetLevelSuccess:function(a){var b;0===a.code?(this.departmentList=a.data[0].departmentList,this.orderList(),b=this.getDepartListHtml(this.departmentList),document.querySelector("#depart_list").innerHTML=b):this.handleError(a)},orderList:function(){for(var a=[],b=[],c=this.departmentList,d=0;d<c.length;d++)c[d].id=c[d].departId,c[d].name=c[d].departName,!c[d].secondDepart||c[d].secondDepart.length<=0?b.push(c[d]):a.push(c[d]);this.departmentList=b.concat(a),this.departmentCacheList=b},getDepartListHtml:function(a){for(var b="",c=0;c<a.length;c++){var d,e,f,g=a[c].secondDepart;!g||g.length<=0?(e="",d='class="check-list no-arrow"',f='onclick="myInfoChangeDepart.selectedDepartment(event)"'):(e=a[c].parentId,d='class=""',f='href="my-info-change-depart-second.html?parentId='+a[c].departId+'"'),b+="<a "+f+' parentId="'+e+'" value="'+a[c].departId+'" '+d+">"+a[c].departName+"</a>"}return b+='<a onclick="myInfoChangeDepart.addNewDepartment();">其他</a>'},addNewDepartment:function(){var a;a={popWindow:this.popWindow,title:"输入自定义科室名",placeHolder:"输入自定义科室名",pageJSObjName:"myInfoChangeDepart",pageJSObj:myInfoChangeDepart,cacheDataList:this.departmentCacheList,okCallBack:this.doSaveNewDepart.bind(this),cancelCallBack:this.cancelNewDepartCallback.bind(this),selectedTipListCallback:this.selectSearchItem.bind(this),messageBox:this.messageBox,errorMsg:"请输入正确的科室名称",inputLen:10,mask:!0},this.searchFromCache.showSearchBox(a)},doSaveNewDepart:function(a){this.selectedDepartId?this.doSave(this.selectedDepartId):this.doSave(0,a),this.selectedDepartId=null},cancelNewDepartCallback:function(){this.popWindow.hide()},selectSearchItem:function(a){this.selectedDepartId=a},selectedDepartment:function(a){var b=a.currentTarget,c=b.getAttribute("value");b.getAttribute("parentId");this.toggleChecked(b),this.doSave(c)},doSave:function(a,b){var c={sendParameters:{departmentId:a}};b&&""!==b&&(c.sendParameters.customDepartment=b),c.url=SYS_VAR.SERVER_ADDRESS+"doc/info_update/",c.type="GET",c.asyn=!0,c.onSuccess=this.handleSaveSuccess.bind(this),c.onError=this.handleError.bind(this),c.mssage=this.messageBox,this.ajax.send(c)},toggleChecked:function(a){for(var b=document.querySelectorAll("#depart_list .check-list"),c=0;c<b.length;c++)a===b[c]?b[c].className="check-list no-arrow checked":b[c].className="check-list no-arrow"},handleSaveSuccess:function(a){0===a.code?window.location.href="my-information.html":this.handleError(a)},handleError:function(a){var b=a.msg;b&&""!==b||(b="网络异常，请稍后重试!"),this.messageBox.show({msg:b,type:"alert",autoClose:!0})},attachEvent:function(){}};myInfoChangeDepart.init();