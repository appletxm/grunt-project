var myTime={serverAddress:SYS_VAR.SERVER_ADDRESS,ajax:null,messageBox:null,popWindow:null,timeSwitchStatus:1,timeLength:0,timeSwitcher:null,timeChooser:null,cutDownTimer:0,init:function(){this.ajax=new Ajax,this.messageBox=new MessageBox,this.popWindow=new PopWindow,this.getDoctorTimeStatus(),this.attachEvent()},getDoctorTimeStatus:function(){var a={sendParameters:{}};a.sendParameters.status=0,a.sendParameters.time=0,a.sendParameters.sendTime=(new Date).getTime(),a.sendParameters.action="get",a.url=this.serverAddress+"msg_center/h5_api/",a.type="GET",a.asyn=!0,a.onSuccess=this.hanlderGetStatusSuccess.bind(this),a.onError=this.hanlderGetStatusError.bind(this),a.mssage=this.msessageBox,this.ajax.send(a)},hanlderGetStatusSuccess:function(a){0===a.code||"0"===a.code?(this.showTimeStatus(a.data[0].result[0]),0===a.data[0].result[0].status||"0"===a.data[0].result[0].status?this.showRemainTime(0):this.showRemainTime(a.data[0].result[0].remainTime)):(this.hanlderGetStatusError(a),this.showRemainTime(0))},showTimeStatus:function(a){0===a.status||"0"===a.status?this.toggleTimeSwitch(!1):(this.toggleTimeSwitch(!0),this.setChooser(a.time))},setChooser:function(a){document.querySelector("#showTimeText").innerHTML=a/60/1e3},hanlderGetStatusError:function(a){this.toggleTimeSwitch(!0)},toggleTimeSwitch:function(a){var b;this.timeSwitcher=document.querySelector("#timeSwitch"),this.timeChooser=document.querySelector("#timeChoose"),this.timeTip=document.querySelector("#timeCutDown"),b=this.timeSwitcher.querySelectorAll("input")[0],a===!0?(this.timeSwitcher.className="animate-check",this.timeChooser.style.display="block",this.timeTip.style.display="block",b.value=1,this.timeSwitchStatus=1):(this.timeSwitcher.className="animate-check close",this.timeChooser.style.display="none",this.timeTip.style.display="none",b.value=0,this.timeSwitchStatus=0)},handleClick:function(a){var b=a.target,c=b.tagName.toLowerCase();("span"===c||"b"===c)&&this.doToggleTime(),a.preventDefault()},handleChange:function(a){var b=a.getAttribute("value");document.querySelector("#showTimeText").innerHTML=b,this.showRemainTime(60*parseInt(b,10)*1e3)},getTimeListHtml:function(){var a=[];return a.push('<ul class="mask-time" style="display: block;">'),a.push('<li value="10">10分钟</li>'),a.push('<li value="15">15分钟</li>'),a.push('<li value="20">20分钟</li>'),a.push('<li value="25">25分钟</li>'),a.push('<li value="30">30分钟</li>'),a.push('<li value="35">35分钟</li>'),a.push('<li value="40">40分钟</li>'),a.push('<li value="45">45分钟</li>'),a.push('<li value="50">50分钟</li>'),a.push('<li value="55">55分钟</li>'),a.push('<li value="60">1小时</li>'),a.push('<li value="120">2小时</li>'),a.push('<li value="720">12小时</li>'),a.push("</ul>"),a.join("")},showTimeList:function(){var a="",b={buttons:[],space:{}};a=this.getTimeListHtml(),b.needMask=!0,b.title="选择出诊时长",b.space={top:100,left:50},b.contentClickCallback=this.selectedTimeCallback.bind(this),b.content=a,b.buttons.push({text:"取 消",css:"cancel x1",callback:"myTime.closeTimeList()"}),this.popWindow.show(b),this.messageBox.hide()},selectedTimeCallback:function(a){var b=a.target;"li"===b.tagName.toLowerCase()&&(this.handleChange(b),this.closeTimeList())},closeTimeList:function(){this.popWindow.hide()},doToggleTime:function(){var a=this.timeSwitcher.querySelectorAll("input")[0];this.timeSwitchStatus=parseInt(a.value,10),this.timeSwitchStatus=1===this.timeSwitchStatus?0:1,a.value=this.timeSwitchStatus,this.toggleTimeSwitch(1===this.timeSwitchStatus)},showRemainTime:function(a){var b=document.querySelector("#timeCutDown"),c=b.querySelectorAll("b")[0],d=new Date,e=0,f=0,g=0;0===a||"0"===a?(c.innerTHTML="00:00:00",b.style.display="none"):(d.setTime(d.getTime()+a),e=d.getHours(),f=d.getMinutes(),g=d.getSeconds(),e=10>e?"0"+e:e,f=10>f?"0"+f:f,g=10>g?"0"+g:g,c.innerHTML=e+":"+f+":"+g,b.style.display="block")},doSetTime:function(){var a={sendParameters:{}},b=0;return b=document.querySelector("#showTimeText").innerHTML||"0",b=parseInt(b,10),0===b?(this.messageBox.show({msg:"请选择出诊时间",type:"alert",autoClose:!0}),!1):(a.sendParameters.status=this.timeSwitchStatus,a.sendParameters.time=1===this.timeSwitchStatus?60*b*1e3:0,a.sendParameters.sendTime=(new Date).getTime(),a.sendParameters.action="set",a.url=this.serverAddress+"msg_center/h5_api/",a.type="GET",a.asyn=!0,a.onSuccess=this.hanlderSaveTimeSuccess.bind(this),a.onError=this.hanlderSaveTimeError.bind(this),a.mssage=this.msessageBox,void this.ajax.send(a))},hanlderSaveTimeSuccess:function(a){var b=document.querySelector("#showTimeText").innerHTML||"0";0===a.code||"0"===a.code?(this.messageBox.show({msg:"保存成功",type:"alert",autoClose:!0}),1===this.timeSwitchStatus&&this.showRemainTime(60*parseInt(b,10)*1e3)):this.hanlderSaveTimeError(a)},hanlderSaveTimeError:function(a){this.messageBox.show({msg:a.msg||"保存出诊时间失败，请重试",type:"alert",autoClose:!0}),this.showRemainTime(0)},attachEvent:function(){var a=document.querySelector("#myTimepanel"),b=document.querySelector("#timeChoose"),c=document.querySelector("#saveTime");a.addEventListener("click",function(a){this.handleClick(a)}.bind(this)),b.addEventListener("click",function(a){this.showTimeList(a)}.bind(this)),c.addEventListener("click",function(a){this.doSetTime(a)}.bind(this))}};myTime.init();