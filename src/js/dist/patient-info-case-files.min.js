"use strict";var mockCaseFilesList={code:0,msg:"成功",data:[{pageNo:1,pageSize:10,orderBy:null,order:null,result:[{id:"sjdlkcvdsfj",hospital:"广东省人民医院",department:"产科",vistingTime:"348728373457449",description:"病情描述",imgs:[{imgUrl:"../../styles/images/ad_0.png"},{imgUrl:"../../styles/images/ad_1.png"},{imgUrl:"../../styles/images/ad_2.png"},{imgUrl:"../../styles/images/ad_0.png"},{imgUrl:"../../styles/images/ad_1.png"},{imgUrl:"../../styles/images/ad_2.png"}]}],totalCount:2,first:0,orderBySetted:!1,totalPages:1,hasNext:!1,nextPage:1,hasPre:!1,prePage:1}]},patientCaseFiles={server:SYS_VAR.SERVER_ADDRESS,messageBox:null,ajax:null,fullScreenViewer:null,requestUrl:SYS_VAR.SERVER_ADDRESS,urlParams:{},patientId:null,pageInfo:{maxImageCount:3,pageNo:1,pageSize:20},init:function(){this.messageBox=new MessageBox,this.ajax=new Ajax,this.fullScreenView=new FullScreenView,this.skipPage=new SkipPage,this.getParamsFromUrl(),this.getPCFList()},getParamsFromUrl:function(){var a=window.location.search;this.urlParams=a.getValueFromUrl(),this.patientId=this.urlParams.patient_id,this.patientId=parseInt(this.patientId,10),this.urlParams=decodeURIComponent(window.localStorage.getItem("patientInfo")),this.urlParams=JSON.parse(this.urlParams),this.setOpenChatButton()},getPCFList:function(){var a=this,b={url:SYS_VAR.SERVER_ADDRESS+"doc/patient_case_list/",type:"GET",asyn:!0,timeout:2e4,onSuccess:a.handleGetInfoSuccess.bind(a),onError:a.handleError.bind(a),sendParameters:{patientId:a.patientId,page:a.pageInfo.pageNo,num:a.pageInfo.pageSize}};this.skipPage.init({pageInfo:this.pageInfo,bindObj:document.querySelector("#list-content"),param:b,ajax:this.ajax,needSkipNext:!0,needSkipPrev:!1}),this.showLoading()},handleGetInfoSuccess:function(a){var b="",c=document.querySelector("#list-content"),d='<p class="no-data-tip"></p>';if(0===a.code){var e=a.data;e&&e[0]&&e[0].result&&e[0].result.length>0?(b=this.getListHtml(e[0].result),c.innerHTML=b):this.showNoDateTip(c,d),this.hideLoading()}else this.handleError(a)},showNoDateTip:function(a,b){a.innerHTML=b},getListHtml:function(a){var b=this,c="";return a.forEach(function(a){var c,d=a.vistingTime,e=a.description,f="patient-case-files-details.html";f+="?case_file_id="+encodeURIComponent(a.id),f+="&patient_id="+encodeURIComponent(b.patientId),d=b.dateChange(parseInt(d,10)),c=d.getMonth()+1+"-"+d.getDate(),e.length>10&&(e=e.substring(0,10)+"..."),a.descriptionStr=e,a.timeStr=c,a.detailUrl=f}),c=template(document.getElementById("list-content-tpl").innerHTML,{list:a})},showPanelGap:function(a){var b,c=[];return document.querySelector("#panel_"+a.getFullYear())||(b=a.getFullYear()+"年"+(a.getMonth()+1)+"月",c.push('<li class="date-gap" id="panel_'+a.getFullYear()+'">'+b+"</li>")),c},dateChange:function(a){var b,c=new Date;return b=(typeof a).toLowerCase(),"number"===b&&c.setTime(a),c},mediaFullScreenView:function(a,b,c){this.fullScreenView.show({type:b,src:a,event:c})},handleError:function(a){var b=a.msg;""!==b&&b||(b="网络异常，请稍后再试"),this.messageBox.show({msg:b,type:"alert",autoClose:!0})},setOpenChatButton:function(){var a=this.urlParams,b="../chat/chat.html",c=document.querySelectorAll("footer")[0];b+="?patient_id="+encodeURIComponent(a.patient_id),b+="&patient_name="+encodeURIComponent(a.patient_name),b+="&patient_icon="+encodeURIComponent(a.patient_icon),b+="&doctor_id="+encodeURIComponent(a.doctor_id),c.innerHTML='<a href="'+b+'">发送消息</a>'},showLoading:function(){this.messageBox.show({msg:'<span class="fa fa-spinner fa-pulse fa-2x fa-fw"></span>',type:"loading",autoClose:!1})},hideLoading:function(){this.messageBox.hide()}};patientCaseFiles.init();