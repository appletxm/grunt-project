var myInfoChangePhone={ajax:null,messageBox:null,validateTarget:null,validateCodeActive:!1,phoneNoisOk:!1,init:function(){this.ajax=new Ajax,this.messageBox=new MessageBox,this.validateTarget=document.querySelector("#getVerifyCode"),this.attachEvent()},doSave:function(a){var b={sendParameters:{phone:document.querySelector("#phone").value,verifyCode:document.querySelector("#verifyCode").value}};return this.doValidate(!0)?(b.url=SYS_VAR.SERVER_ADDRESS+"doc/info_update/",b.type="GET",b.asyn=!0,b.onSuccess=this.hanlderSaveSuccess.bind(this),b.onError=this.hanlderSaveError.bind(this),void this.ajax.send(b)):!1},hanlderSaveSuccess:function(a){0===a.code?window.location.href="my-information.html":this.hanlderSaveError(a)},sendSMS:function(a){if(this.doValidate(!1)){var b={sendParameters:{actionType:"3",phoneNum:document.querySelector("#phone").value}};b.url=SYS_VAR.SERVER_ADDRESS+"doc/get_sms/",b.type="GET",b.asyn=!0,b.onSuccess=this.hanlderSendSMSSuccess.bind(this),b.onError=this.hanlderSaveError.bind(this),this.ajax.send(b)}},hanlderSendSMSSuccess:function(a){0===a.code?(this.messageBox.show({msg:"短信已发送到您的手机，请注意查收",type:"alert",autoClose:!0}),this.validateTarget.className+=" actived",this.startCutDownTimer(),this.validateCodeActive=!0,this.phoneNoisOk=!0):(this.phoneNoisOk=!1,this.hanlderSaveError(a))},hanlderSaveError:function(a){this.messageBox.show({msg:a.msg,type:"alert",autoClose:!0})},doValidate:function(a){var b=document.querySelector("#phone").value,c=document.querySelector("#verifyCode").value;return b&&b.match(/[1][1-9][0-9]{9}/g)?!a||c&&c.match(/[0-9]{4}/g)?!0:(this.messageBox.show({msg:"请输入验证码",type:"alert",autoClose:!0}),!1):(this.messageBox.show({msg:"请输入正确的手机号",type:"alert",autoClose:!0}),!1)},doSendSMS:function(a){this.sendSMS()},startCutDownTimer:function(){var a=60;this.validateTarget.innerHTML="<b>"+a+"</b>秒后重试";var b=setInterval(function(){a>=0?(this.validateTarget.innerHTML="<b>"+a+"</b>秒后重试",a--):(this.validateTarget.innerHTML="获取验证码",this.validateTarget.className="",this.validateCodeActive=!1,clearInterval(b))}.bind(this),1e3)},attachEvent:function(){var a=document.querySelector("#save"),b=document.querySelector("#getVerifyCode");a.addEventListener("click",function(a){this.doSave(a)}.bind(this)),b.addEventListener("click",function(a){this.sendSMS(a)}.bind(this))}};myInfoChangePhone.init();