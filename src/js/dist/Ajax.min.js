var Ajax=function(){this.xmlHttp=null,this.parameters={},this.msgs={paramError:"参数有误"},this.GetXmlHttpObject=function(){var a=null;try{a=new XMLHttpRequest}catch(b){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){a=new ActiveXObject("Microsoft.XMLHTTP")}}return a},this.xmlHttp=this.GetXmlHttpObject(),this.send=function(a){var b=a;return this.parameters=a,b.timeout||(b.timeout=2e4),b.url&&""!==b.url?(this.starAnimate(),void this.doAjax(a)):(b.onError&&b.onError({msg:this.msgs.paramError}),!1)},this.doAjax=function(a){var b,c;if(this.parameters=a,a.cache||(b=a.url.indexOf("?")>=0?a.url+"&timer="+Math.random():a.url+"?timer="+Math.random()),"GET"===a.type?(c=a.sendParameters?this.getGetParameters(a.sendParameters):null,b=b.indexOf("?")>=0?b+"&"+c:b+"?"+c,c=null):c=a.sendParameters?this.getPostParameters(a.sendParameters):null,a.isJsonp&&a.needNewScript)this.doJsonpNewScript(a);else{if(this.xmlHttp.onreadystatechange=this.stateChanged.bind(this),this.xmlHttp.open(a.type,b,a.asyn||!1),"POST"===a.type)try{this.xmlHttp.setRequestHeader("Content-Type","text/json")}catch(d){alert(d)}this.xmlHttp.send(this.parameters.needPostJson?JSON.stringify(this.parameters.sendParameters):c)}},this.getGetParameters=function(a){var b="";if("object"===(typeof a).toLowerCase())for(var c in a)b+=c+"="+a[c]+"&";return b=b.substring(0,b.length-1)},this.getPostParameters=function(a){var b="";if("object"===(typeof a).toLowerCase())for(var c in a)b+=c+"="+JSON.stringify(a[c])+"&";return b=b.substring(0,b.length-1)},this.stateChanged=function(){this.xmlHttp;4===this.xmlHttp.readyState&&(200==this.xmlHttp.status?this.onSuccess(this.xmlHttp.responseText):this.onError(this.xmlHttp.responseText))},this.onSuccess=function(a){var b,c=this.parameters;this.parameters.isJsonp?this.doJsonpNewFunction(a):(b=JSON.parse(a),("0"===b.code||0===b.code)&&this.endAnimate(),c.onSuccess&&c.onSuccess(b))},this.onError=function(a){var b=this.parameters;b.onError&&b.onError({msg:this.xmlHttp.responseText})},this.doJsonpNewScript=function(a){var b,c,d;d=document.querySelectorAll("body")[0],c=a.url,c=c.indexOf("?")>=0?"&callback="+a.callback:"?callback="+a.callback,b=document.querySelector("dynamicScript"),b&&b.length>0&&d.removeChild(b),b=document.createElement("script"),b.setAttribute("src",c),b.setAttribute("id","dynamicScript"),d.appendChild(b),this.endAnimate()},this.doJsonpNewFunction=function(a){var b=new Function(a);b()},this.starAnimate=function(){var a=this.parameters.mssage;a&&a.show({msg:'<span class="fa fa-spinner fa-pulse fa-2x fa-fw"></span>',type:"loading",autoClose:!1})},this.endAnimate=function(){var a=this.parameters.mssage;a&&a.hide()}};