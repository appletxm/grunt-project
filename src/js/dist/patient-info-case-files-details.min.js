"use strict";var mockCaseFilesDetail={code:0,msg:"成功",data:[{id:"kfjskdljdfvkds",hospital:"广东省人民医院广东省人民医院广东省人民医院广东省人民医院",department:"产科",doctor:"张三丰",vistingTime:"1328373457449",description:"病情描述",adviceList:[{imgUrl:"../../styles/images/ad_0.png"},{imgUrl:"../../styles/images/ad_1.png"},{imgUrl:"../../styles/images/ad_2.png"},{imgUrl:"../../styles/images/ad_2.png"}],prescriptionList:[{imgUrl:"../../styles/images/ad_0.png"},{imgUrl:"../../styles/images/ad_1.png"},{imgUrl:"../../styles/images/ad_2.png"}],checkList:[{imgUrl:"../../styles/images/ad_0.png"},{imgUrl:"../../styles/images/ad_1.png"},{imgUrl:"../../styles/images/ad_2.png"}]}]},patientCaseFilesDetails={messageBox:null,ajax:null,fullScreenViewer:null,requestUrl:SYS_VAR.SERVER_ADDRESS,urlParams:{},patientId:null,caseId:null,init:function(){this.messageBox=new MessageBox,this.ajax=new Ajax,this.fullScreenView=new FullScreenView,this.getParamsFromUrl(),this.getPCFileDetail()},getParamsFromUrl:function(){var a=window.location.search;this.urlParams=a.getValueFromUrl(),this.patientId=this.urlParams.patient_id,this.patientId=parseInt(this.patientId,10),this.caseId=this.urlParams.case_file_id,this.urlParams=decodeURIComponent(window.localStorage.getItem("patientInfo")),this.urlParams=JSON.parse(this.urlParams),this.setOpenChatButton()},getPCFileDetail:function(){var a=this,b={url:SYS_VAR.SERVER_ADDRESS+"doc/patient_case_detail/",type:"GET",asyn:!0,onSuccess:a.handleGetInfoSuccess.bind(a),onError:a.handleError.bind(a),sendParameters:{patientId:a.patientId,caseId:a.caseId}};this.showLoading(),this.ajax.send(b)},handleGetInfoSuccess:function(a){var b=[],c=document.querySelector("#caseFileDetails"),d='<p class="no-data-tip no-case-file"></p>';if(0===a.code){var e=a.data;e&&""!==e&&e[0]?(b=b.concat(this.getDetailHtml(e[0])),c.innerHTML=b.join("")):this.showNoDateTip(c,d),this.hideLoading()}else this.handleError(a)},showNoDateTip:function(a,b){a.innerHTML=b},getDetailHtml:function(a){var b,c,d=[],e="<i>患者未上传医嘱</i>",f="<i>患者未上传处方单</i>",g="<i>患者未上传检查单</i>";return a.adviceList&&a.adviceList.length>0&&(e=this.getImageHtml(a.adviceList)),a.prescriptionList&&a.prescriptionList.length>0&&(f=this.getImageHtml(a.prescriptionList)),a.checkList&&a.checkList.length>0&&(g=this.getImageHtml(a.checkList)),b=this.dateChange(parseInt(a.vistingTime,10)),c=b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate(),d.push("<h6>病情描述</h6>"),d.push('<p class="case-details">'+(a.description||"<i>患者末填写病情描述</i>")+"</p>"),d.push('<div class="images-box">'),d.push("<dl>"),d.push("<dt>医嘱</dt>"),d.push("<dd>"),d.push(e),d.push("</dd>"),d.push(" </dl>"),d.push("<dl>"),d.push("<dt>处方单</dt>"),d.push("<dd>"),d.push(f),d.push("</dd>"),d.push(" </dl>"),d.push("<dl>"),d.push("<dt>检查单</dt>"),d.push("<dd>"),d.push(g),d.push("</dd>"),d.push(" </dl>"),d.push("</div>"),d.push('<div class="table-wrap">'),d.push('<table class="msg-table">'),d.push("<tr>"),d.push('<td class="title">就诊时间</td>'),d.push('<td class="value">'+c+"</td>"),d.push("</tr>"),d.push('<tr class="no-after-arrow">'),d.push('<td class="title">就诊医院</td>'),d.push('<td class="value">'+(a.hospital||"")+"</td>"),d.push("</tr>"),d.push('<tr class="no-after-arrow">'),d.push('<td class="title">就诊科室</td>'),d.push('<td class="value">'+(a.department||"")+"</td>"),d.push("</tr>"),d.push('<tr class="no-after-arrow">'),d.push('<td class="title">医生</td>'),d.push('<td class="value">'+(a.doctor||"")+"</td>"),d.push("</tr>"),d.push("</table>"),d.push("</div>"),d},mediaFullScreenView:function(a,b,c){this.fullScreenView.show({type:b,src:a,event:c})},getImageHtml:function(a){var b=[];return a.forEach(function(a){var c=a.imgUrl;c&&""!==c&&"null"!==c&&"undefined"!==c&&b.push('<span><img src="'+c+'?s=t" onclick="patientCaseFilesDetails.mediaFullScreenView(\''+c+'\', 1, event);" width="80" height="80"></span>')}),b.join("")},dateChange:function(a){var b,c=new Date;return b=(typeof a).toLowerCase(),"number"===b&&c.setTime(a),c},handleError:function(a){var b=a.msg;""!==b&&b||(b="网络异常，请稍后再试"),this.messageBox.show({msg:b,type:"alert",autoClose:!0})},setOpenChatButton:function(){var a=this.urlParams,b="../chat/chat.html",c=document.querySelectorAll("footer")[0];b+="?patient_id="+encodeURIComponent(a.patient_id),b+="&patient_name="+encodeURIComponent(a.patient_name),b+="&patient_icon="+encodeURIComponent(a.patient_icon),b+="&doctor_id="+encodeURIComponent(a.doctor_id),c.innerHTML='<a href="'+b+'">发送消息</a>'},showLoading:function(){this.messageBox.show({msg:'<span class="fa fa-spinner fa-pulse fa-2x fa-fw"></span>',type:"loading",autoClose:!1})},hideLoading:function(){this.messageBox.hide()}};patientCaseFilesDetails.init();