"use strict";var mockListData={data:[{id:3,doctorId:1,name:"分组",medicationIds:"16495,10049,7044",createdAt:"2015-06-23 23:24:48",changedAt:null},{id:4,doctorId:1,name:"分组1",medicationIds:"16495,10049,7044,7044",createdAt:"2015-06-23 23:24:48",changedAt:null}],msg:"成功",code:0},mockSaveRes={data:[],msg:"成功",code:0},presctiptionsList={ajax:null,messageBox:null,listDelID:[],init:function(){this.messageBox=new MessageBox,this.ajax=new Ajax,this.attachEvent(),this.getPresctiptionsList()},getPresctiptionsList:function(){var a={sendParameters:{}};a.url=SYS_VAR.SERVER_ADDRESS+"doc/medication_group_list/",a.type="GET",a.asyn=!0,a.onSuccess=this.handleGetInfoSuccess.bind(this),a.onError=this.handleError.bind(this),this.showLoading(),this.ajax.send(a)},handleGetInfoSuccess:function(a){var b=document.querySelector("#prescriptions-list ul").innerHTML;a.data.forEach(function(a){var c=""===a.medicationIds?[]:a.medicationIds.split(","),d=encodeURIComponent(a.name),e=encodeURIComponent(a.medicationIds);b+='<li><a href="prescriptions-drug-list.html?flag=1&group_id='+a.id+"&group_name="+d+"&medication_ids="+e+'">'+a.name+"("+c.length+')</a><i data-id="'+a.id+'" class="delBtn"></i></li>'}),document.querySelector("#prescriptions-list ul").innerHTML=b,this.hideLoading()},handleError:function(a){var b=a.msg;b&&""!==b||(b="网络异常，请稍后重试"),this.messageBox.show({msg:b,type:"alert",autoClose:!0}),this.listDelID=[]},doSavePresctiptionsList:function(){var a={sendParameters:{}};a.sendParameters.ids=this.listDelID.join(),a.url=SYS_VAR.SERVER_ADDRESS+"doc/medication_group_remove/",a.type="GET",a.asyn=!0,a.onSuccess=this.handleSaveListSuccess.bind(this),a.onError=this.handleError.bind(this),this.ajax.send(a)},handleSaveListSuccess:function(a){(0===a.code||"0"===a.code)&&(this.messageBox.show({msg:"保存成功！",type:"alert",autoClose:!0}),this.listDelID=[])},attachEvent:function(){var a=document.querySelector("#del"),b=document.querySelector("#save"),c=document.querySelector("#prescriptions-list ul");a.addEventListener("click",this.delPrescriptions.bind(this)),b.addEventListener("click",this.saveEditList.bind(this)),c.addEventListener("click",this.listDelBtn.bind(this))},saveEditList:function(a){for(var b=document.querySelectorAll("#prescriptions-list li"),c=document.querySelectorAll(".btn-group"),d=0;d<b.length;d++)b[d].childNodes[0].className="",b[d].childNodes[1]&&(b[d].childNodes[1].style.display="none");this.listDelID.length>0&&this.doSavePresctiptionsList(),c[0].style.display="block",c[1].style.display="none",a.stopPropagation(),a.preventDefault()},delPrescriptions:function(a){for(var b=document.querySelectorAll("#prescriptions-list li"),c=document.querySelectorAll(".btn-group"),d=0;d<b.length;d++)b[d].childNodes[0].className="no-arrow",b[d].childNodes[1]&&(b[d].childNodes[1].style.display="block");c[0].style.display="none",c[1].style.display="block",a.stopPropagation()},listDelBtn:function(a){if(a.target&&"I"===a.target.nodeName){var b=a.target.getAttribute("data-id"),c=a.target.parentNode;c.parentNode.removeChild(c),b&&this.listDelID.push(b)}},showLoading:function(){this.messageBox.show({msg:'<span class="fa fa-spinner fa-pulse fa-2x fa-fw"></span>',type:"loading",autoClose:!1})},hideLoading:function(){this.messageBox.hide()}};presctiptionsList.init();