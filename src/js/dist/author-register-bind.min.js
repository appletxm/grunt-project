var registerBind={ajax:null,messageBox:null,currentLoginType:0,validateTarget:null,validateCodeActive:!1,init:function(){this.ajax=new Ajax,this.messageBox=new MessageBox,this.attachEvent()},handlePanelClick:function(a){var b=a.target;"chooseUserType"===b.getAttribute("id")||"b"===b.tagName.toLowerCase()?("b"===b.tagName.toLowerCase()&&(b=b.parentNode),this.changeLoginType(b)):"getValidateCode"===b.getAttribute("id")?this.getValidateCode(b):"doRegister"===b.getAttribute("id")?this.doRegister():"doBind"===b.getAttribute("id")&&this.doBind()},changeLoginType:function(a){var b=a.querySelectorAll("b")[0];b.className.indexOf("selected")>=0?this.changeToRegister(a):this.changeToLogin(a)},changeToRegister:function(a){this.currentLoginType=0,a.querySelectorAll("b")[0].className="",document.querySelectorAll(".passwordPanel")[0].style.display="none",document.querySelector("#doBind").style.display="none",document.querySelectorAll(".validatePanel")[0].style.display="block",document.querySelector("#doRegister").style.display="block"},changeToLogin:function(a){this.currentLoginType=1,a.querySelectorAll("b")[0].className="selected",document.querySelectorAll(".passwordPanel")[0].style.display="block",document.querySelector("#doBind").style.display="block",document.querySelectorAll(".validatePanel")[0].style.display="none",document.querySelector("#doRegister").style.display="none"},getValidateCode:function(a){var b=document.querySelector("#phoneNo").value;return b&&""!==b&&/^1[0-9][0-9]\d{4,8}$/.test(b)?void(this.validateCodeActive||this.sendCodeToUser()):void this.messageBox.show({msg:"请输入正确的手机号码",type:"alert",autoClose:!0})},sendCodeToUser:function(){var a=(document.querySelector("#phoneNo").value,{sendParameters:{actionType:"1",phoneNum:document.querySelector("#phoneNo").value}});a.url=SYS_VAR.SERVER_ADDRESS+"doc/get_sms/",a.type="GET",a.asyn=!0,a.onSuccess=this.hanlderSendSMSSuccess.bind(this),a.onError=this.onError.bind(this),a.mssage=this.messageBox,this.ajax.send(a)},hanlderSendSMSSuccess:function(a){0===a.code?(this.messageBox.show({msg:"短信已发送到您的手机，请注意查收",type:"alert",autoClose:!0}),this.validateTarget=document.querySelector("#getValidateCode"),this.validateTarget.className="actived",this.startCutDownTimer(),this.validateCodeActive=!0):this.onError(a)},startCutDownTimer:function(){var a=60;this.validateTarget.innerHTML="<b>"+a+"</b>秒后重试";var b=setInterval(function(){a>=0?(this.validateTarget.innerHTML="<b>"+a+"</b>秒后重试",a--):(this.validateTarget.innerHTML="获取验证码",this.validateTarget.className="",this.validateCodeActive=!1,clearInterval(b))}.bind(this),1e3)},doRegister:function(){var a=this.validate();if(!a.res)return void this.messageBox.show({msg:a.msg,type:"alert",autoClose:!0});var b={sendParameters:{phoneNum:document.querySelector("#phoneNo").value,verifyCode:document.querySelector("#validateCode").value}};b.url=SYS_VAR.SERVER_ADDRESS+"doc/register/",b.type="GET",b.asyn=!0,b.onSuccess=this.onSuccess.bind(this),b.onError=this.onError.bind(this),b.mssage=this.messageBox,this.ajax.send(b)},doBind:function(){var a=this.validate();if(!a.res)return void this.messageBox.show({msg:a.msg,type:"alert",autoClose:!0});var b={sendParameters:{phoneNum:document.querySelector("#phoneNo").value,password:document.querySelector("#password").value}};b.url=SYS_VAR.SERVER_ADDRESS+"doc/login/",b.type="GET",b.asyn=!0,b.onSuccess=this.onSuccess.bind(this),b.onError=this.onError.bind(this),b.mssage=this.messageBox,this.ajax.send(b)},validate:function(){var a=document.querySelector("#phoneNo").value;document.querySelector("#password").value,document.querySelector("#validateCode").value;return a&&""!==a&&/^1[1-9][0-9]\d{4,8}$/.test(a)?{res:!0,msg:""}:{res:!1,msg:"请输入正确的手机号码"}},onSuccess:function(a){0===a.code?window.location.href="../../../../templates/my/my-information.html":this.onError(a)},onError:function(a){this.messageBox.show({msg:a.msg,type:"alert",autoClose:!0})},attachEvent:function(){var a=document.querySelector("#authorRegisterPanel");a.addEventListener("click",function(a){this.handlePanelClick(a)}.bind(this),!1)}};registerBind.init();