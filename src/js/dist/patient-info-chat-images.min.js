"use strict";var mockImageList={code:0,msg:"成功",data:[{pageNo:1,pageSize:10,baseUrl:"",result:[{date:"2015-12-3",images:["http://10.9.2.34/ci/48457/7070/20151210/6226555883462819523.jpg","http://rainyin.com/two-dimension-code.png","../../styles/images/ad_2.png","http://10.9.2.34/ci/48457/7070/20151210/6226555883462819523.jpg","http://rainyin.com/two-dimension-code.png"]},{date:"2015-12-2",images:["../../styles/images/ad_1.png","../../styles/images/ad_0.png","../../styles/images/ad_2.png"]},{date:"2015-6-29",images:["../../styles/images/ad_1.png","../../styles/images/ad_0.png","../../styles/images/ad_2.png"]}],totalCount:4,totalPages:3}]},patientChatImages={requestUrl:SYS_VAR.SERVER_ADDRESS,messageBox:null,ajax:null,fullScreenView:null,skipPage:null,urlParams:{},patientId:null,baseUrl:"",pageInfo:{pageNo:1,orderby:1,pageSize:10},init:function(){this.messageBox=new MessageBox,this.ajax=new Ajax,this.skipPage=new SkipPage,this.fullScreenView=new FullScreenView,this.getParamsFromUrl(),this.resizeImgCell(),this.getChatImage({bindObj:document.querySelector("#chatImagePanel")})},getParamsFromUrl:function(){var a=window.location.search;this.urlParams=a.getValueFromUrl(),this.patientId=this.urlParams.patient_id,this.patientId=parseInt(this.patientId,10),this.urlParams=decodeURIComponent(window.localStorage.getItem("patientInfo")),this.urlParams=JSON.parse(this.urlParams),this.setOpenChatButton()},getChatImage:function(a){var b={sendParameters:{}},c=this.urlParams,d=this.pageInfo;b.sendParameters.patient_id=this.patientId,b.sendParameters.doctor_id=c.doctor_id,b.sendParameters.page=d.pageNo,b.sendParameters.num=d.pageSize,b.sendParameters.orderby=d.orderby,b.url=this.requestUrl+"doc/patient_img_history/",b.type="GET",b.asyn=!0,b.onSuccess=this.handleGetInfoSuccess.bind(this),b.onError=this.handleError.bind(this),this.skipPage.init({pageInfo:d,bindObj:a.bindObj,param:b,ajax:this.ajax,needSkipNext:!0,needSkipPrev:!1}),this.showLoading()},handleGetInfoSuccess:function(a){var b,c=[],d=document.querySelector("#chatImagePanel"),e='<p class="no-data-tip"></p>';if(this.skipPage.isFirstLoad=!1,0===a.code){var f=a.data;f&&""!==f&&f[0]&&f[0].result&&f[0].result.length>0?(this.baseUrl=f[0].baseUrl,b=document.createElement("span"),c=c.concat(this.getListHtml(f[0].result)),b.innerHTML=c.join(""),d.appendChild(b),document.querySelector("#frameLine").style.display="block"):this.showNoDateTip(d,e),this.hideLoading()}else this.handleError(a)},getListHtml:function(a){var b=[],c=this;return a.forEach(function(a){b=b.concat(c.getCellHtml(a))}),b},getCellHtml:function(a){var b,c=[],d=a.images;return b=this.getDateString(a.date),c.push('<div class="periphery-box'+("今天"===b?" on":"")+'">'),c.push('<span class="time-box">'+b+"</span>"),c.push('<div class="img-box">'),c.push('<i class="icon"></i>'),c.push(this.getImageHtml(d,this.baseUrl)),c.push('<p class="c"></p>'),c.push("</div>"),c.push("</div>"),c},getDateString:function(a){var b,c,d,e,f,g,h,i=a.split("-"),j=new Date;return b=j.getFullYear(),d=j.getMonth()+1,f=j.getDate(),c=parseInt(i[0],10),e=parseInt(i[1],10),g=parseInt(i[2],10),h=c===b?e===d?f===g?"今天":f-1===g?"昨天":e+"月"+g+"日":e+"月"+g+"日":c+"年"+e+"月"+g+"日"},getImageHtml:function(a,b){var c=[],d=!1;return b&&""!==b&&"null"!==b&&"undefined"!==b||(b=SYS_VAR.base_url),a.forEach(function(a){a&&""!==a&&"null"!==a&&"undefined"!==a&&(d=!(a.indexOf("http:")>=0||a.indexOf("https:")>=0||a.indexOf("../")>=0),a=d===!0?b+a:a,c.push('<span class="image-cell"><div><img src="'+a+'?s=t" onload="patientChatImages.imgCrop(event)" onclick="patientChatImages.mediaFullScreenView(\''+a+"', 1, event);\"></div></span>"))}),c.join("")},resizeImgCell:function(){var a=document.documentElement.clientWidth,b=(a-125)/3,c="";c+=".image-cell{width:"+b+"px!important; height:"+b+"px!important;}",c+=".image-cell div{height:"+(b-10)+"px!important;}",document.querySelector("#userDefineStyle").innerHTML=c},imgCrop:function(a){},mediaFullScreenView:function(a,b,c){this.fullScreenView.show({type:b,src:a,event:c})},showNoDateTip:function(a,b){1===this.pageInfo.pageNo&&(a.className="patient-chat-images-list no-chat-images",a.innerHTML=b)},handleError:function(a){var b=a.msg;""!==b&&b||(b="网络异常，请稍后再试"),this.messageBox.show({msg:b,type:"alert",autoClose:!0})},setOpenChatButton:function(){var a=this.urlParams,b="../chat/chat.html",c=document.querySelectorAll("footer")[0];b+="?patient_id="+encodeURIComponent(a.patient_id),b+="&patient_name="+encodeURIComponent(a.patient_name),b+="&patient_icon="+encodeURIComponent(a.patient_icon),b+="&doctor_id="+encodeURIComponent(a.doctor_id),c.innerHTML='<a href="'+b+'">发送消息</a>'},showLoading:function(){this.messageBox.show({msg:'<span class="fa fa-spinner fa-pulse fa-2x fa-fw"></span>',type:"loading",autoClose:!1})},hideLoading:function(){this.messageBox.hide()}};patientChatImages.init();