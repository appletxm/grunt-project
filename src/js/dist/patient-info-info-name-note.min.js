"use strict";var patientInfoNameNote={server:SYS_VAR.SERVER_ADDRESS,messageBox:null,ajax:null,popWindow:null,slideTab:null,patientId:0,patientNameNote:null,requestUrl:SYS_VAR.SERVER_ADDRESS,init:function(){this.messageBox=new MessageBox,this.ajax=new Ajax,this.getParamsFromUrl(),this.settingInfo(),this.attachEvent()},getParamsFromUrl:function(){var a=window.location.search,b=a.getValueFromUrl();this.patientId=b.patient_id,this.patientId=parseInt(this.patientId,10),this.patientNameNote=b.remark_name?b.remark_name:"",this.urlParams=decodeURIComponent(window.localStorage.getItem("patientInfo")),this.urlParams=JSON.parse(this.urlParams)},settingInfo:function(){var a=document.querySelector("#note");a.value=this.patientNameNote},setPatientNote:function(){var a=this,b={url:SYS_VAR.SERVER_ADDRESS+"doc/remark_name/",type:"GET",asyn:!0,onSuccess:a.handleSetSuccess.bind(a),onError:a.handleError.bind(a),sendParameters:{patientId:a.patientId,remarkName:document.querySelector("#note").value}};this.showLoading(),this.ajax.send(b)},handleSetSuccess:function(){var a=this,b="patient-info.html",c=a.urlParams;this.messageBox.show({msg:"保存成功！",type:"alert",autoClose:!0}),c.patient_name=document.querySelector("#note").value,window.localStorage.setItem("patientInfo",encodeURIComponent(JSON.stringify(c))),setTimeout(function(){b+="?patient_id="+encodeURIComponent(a.patientId),b+="&patient_name="+encodeURIComponent(c.patient_name),b+="&patient_icon="+encodeURIComponent(c.patient_icon),b+="&doctor_id="+encodeURIComponent(c.doctor_id),window.location.href=b},500)},handleError:function(a){var b=a.msg;""!==b&&b||(b="网络异常，请稍后再试"),this.messageBox.show({msg:b,type:"alert",autoClose:!0})},showLoading:function(){this.messageBox.show({msg:'<span class="fa fa-spinner fa-pulse fa-2x fa-fw"></span>',type:"loading",autoClose:!1})},attachEvent:function(){var a=document.querySelector("#save");a.addEventListener("click",this.setPatientNote.bind(this))}};patientInfoNameNote.init();