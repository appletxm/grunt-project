"use strict";var myTimeHospital={serverAddress:SYS_VAR.SERVER_ADDRESS,ajax:null,messageBox:null,timeSet:{},init:function(){this.ajax=new Ajax,this.messageBox=new MessageBox,this.getDoctorTime(),this.attachEvent()},getDoctorTime:function(){var a={sendParameters:{}};a.sendParameters.status=0,a.sendParameters.time=0,a.sendParameters.sendTime=(new Date).getTime(),a.sendParameters.action="get",a.url=this.serverAddress+"doc/time_list",a.type="GET",a.asyn=!0,a.onSuccess=this.handleGetTimeSuccess.bind(this),a.onError=this.handleError.bind(this),this.showLoading(),this.ajax.send(a)},handleGetTimeSuccess:function(a){0===a.code||"0"===a.code?(this.showHospitalTime(a.data[0]),this.hideLoading()):this.handleError(a)},handleError:function(a){var b=a.msg;(b||""===b)&&(b="网络异常，请稍后再试。"),this.messageBox.show({msg:b,type:"alert",autoClose:!0})},handleClick:function(a){var b=a.target,c=b.tagName.toLowerCase();"i"===c&&(!b.className||b.className.indexOf("selected")<0?b.className="selected":b.className=""),a.preventDefault()},showHospitalTime:function(a){var b=document.querySelectorAll("#hospitalTime .basic-row");a.workTime.forEach(function(a){var c=parseInt(a.weekIndex,10),d=b[c],e=null;d&&(e=d.querySelectorAll("i"),1===a.am&&(e[0].className="selected"),1===a.pm&&(e[1].className="selected"),1===a.night&&(e[2].className="selected"))})},doSetTime:function(){for(var a={sendParameters:{}},b=[],c=document.querySelectorAll("#hospitalTime .basic-row"),d=1;d<c.length;d++){var e=c[d].querySelectorAll("i"),f={weekIndex:d,am:e[0].className&&e[0].className.indexOf("selected")>=0?1:0,pm:e[1].className&&e[1].className.indexOf("selected")>=0?1:0,night:e[2].className&&e[2].className.indexOf("selected")>=0?1:0};b.push(f)}a.sendParameters.sendTime=(new Date).getTime(),a.sendParameters.works=JSON.stringify(b),a.url=this.serverAddress+"doc/save_work_time",a.type="GET",a.asyn=!0,a.onSuccess=this.handleSaveTimeSuccess.bind(this),a.onError=this.handleSaveTimeError.bind(this),this.showLoading(),this.ajax.send(a)},handleSaveTimeSuccess:function(a){0===a.code||"0"===a.code?this.messageBox.show({msg:"保存成功",type:"alert",autoClose:!0}):this.handleSaveTimeError(a),setTimeout(function(){WeixinJSBridge.call("closeWindow")},500)},handleSaveTimeError:function(a){this.messageBox.show({msg:a.msg||"保存出诊时间失败，请重试",type:"alert",autoClose:!0})},showLoading:function(){this.messageBox.show({msg:'<span class="fa fa-spinner fa-pulse fa-2x fa-fw"></span>',type:"loading",autoClose:!1})},hideLoading:function(){this.messageBox.hide()},attachEvent:function(){var a=document.querySelector("#hospitalTime"),b=document.querySelector("#saveTime");a.addEventListener("click",function(a){this.handleClick(a)}.bind(this)),b.addEventListener("click",function(a){this.doSetTime(a)}.bind(this))}};myTimeHospital.init();