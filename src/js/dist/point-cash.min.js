var mockData={msg:"",code:0,data:[{authStatus:1,grandMention:2454,totalPoint:2057,canMentionPoint:2057,minApplyPoint:2e3,bankCard:null,canMentionMon:20570}]},bankListData={code:0,msg:"",data:[{userBankId:"000009",bankName:"中国银行",shortNum:"34567",longNum:"33456789000034567"}]},pointCash={ajax:null,messageBox:null,popWindow:null,bankList:[],selectedBankInfo:{userBankId:"",name:""},init:function(){this.messageBox=new MessageBox,this.ajax=new Ajax,this.popWindow=new PopWindow,this.attachEvent(),this.getPointInfo()},getPointInfo:function(){var a={sendParameters:{}};a.url=SYS_VAR.SERVER_ADDRESS+"doc/query_points/",a.type="GET",a.asyn=!0,a.onSuccess=this.handleGetPointSuccess.bind(this),a.onError=this.handleGetPointError.bind(this),a.mssage=this.msessageBox,this.ajax.send(a)},handleGetPointSuccess:function(a){if(0===a.code){if(a.data&&a.data.length>0){var b,c,d=a.data[0];b=c=d.canMentionMon,c&&(c=(c/100).toFixed(2)),d.bankCard&&(this.selectedBankInfo.userBankId=d.bankCard.userBankId,this.selectedBankInfo.name=d.bankCard.bankName,this.selectedBankInfo.combineName=d.bankCard.bankName+"("+d.bankCard.shortNum+")",this.selectedBankInfo.bankCardNumA=d.bankCard.longNum||0,this.selectedBankInfo.branch=d.bankCard.branch||""),document.querySelector("#canMentionMonYuan").innerHTML=c,document.querySelector("#canMentionMon").innerHTML=b,document.querySelector("#bank").innerHTML=this.selectedBankInfo.combineName||"请选择银行卡"}}else this.handleGetPointError(a)},handleGetPointError:function(a){var b=a.msg;b&&""!==b||(b="网络异常，请稍后再试"),this.messageBox.show({msg:b,type:"alert",autoClose:!0})},applyCash:function(){if(this.doValidate()){var a={};a.url=SYS_VAR.SERVER_ADDRESS+"doc/apply_cash/",a.type="GET",a.asyn=!0,a.sendParameters={card_id:this.selectedBankInfo.userBankId,mentionMon:document.querySelector("#canMentionMon").innerHTML},a.onSuccess=this.applyCashSuccess.bind(this),a.onError=this.applyCashError.bind(this),a.mssage=this.messageBox,this.ajax.send(a)}},doValidate:function(){return this.selectedBankInfo.userBankId&&""!==this.selectedBankInfo.userBankId?this.selectedBankInfo.branch&&""!==this.selectedBankInfo.branch?!0:(this.showAddBranchMessage(),!1):(this.messageBox.show({msg:"请选择银行卡",type:"alert",autoClose:!0}),!1)},showBankList:function(a){var b={buttons:[],space:{}};b.needMask=!0,b.title="选择银行卡",b.space={top:50,left:20},b.content=a,b.buttons.push({text:"取 消",css:"cancel x1",callback:"pointCash.cancelSelectBankCallback()"}),this.popWindow.show(b)},selectedBankCallback:function(a){var b=a.currentTarget,c=b.getAttribute("branch");this.selectedBankInfo.userBankId=b.getAttribute("userBankId"),this.selectedBankInfo.name=b.getAttribute("realName"),this.selectedBankInfo.combineName=b.getAttribute("name"),this.selectedBankInfo.bankCardNumA=b.getAttribute("cardNo"),this.selectedBankInfo.branch=b.getAttribute("branch")||"",c&&""!==c?(document.querySelector("#bank").innerHTML=this.selectedBankInfo.name,this.popWindow.hide()):this.showAddBranchMessage()},cancelSelectBankCallback:function(){this.popWindow.hide()},getBankList:function(){if(this.bankList.length>0){var a=this.getBankListHtml(this.bankList);return void this.showBankList(a)}var b={};b.url=SYS_VAR.SERVER_ADDRESS+"doc/query_banks/",b.type="GET",b.asyn=!0,b.onSuccess=this.getBankListSuccess.bind(this),b.onError=this.getBankListError.bind(this),b.mssage=this.msessageBox,this.ajax.send(b)},getBankListHtml:function(a){for(var b='<div class="my-card" style="padding-bottom:0;"><div class="my-time card-list">',c=0;c<a.length;c++){var d=a[c].branch;d&&""!==d&&"null"!==d&&"undefined"!==d||(d=""),b+='<dl userBankId="'+a[c].userBankId+'" branch="'+d+'" onclick="pointCash.selectedBankCallback(event)" name="'+a[c].bankName+"("+a[c].shortNum+')" realName="'+a[c].bankName+'" cardNo="'+(a[c].longNum||0)+'">',b+='<dt style="display:none;"></dt><dd style="margin-left:0;">'+a[c].bankName+'<span class="gray">('+a[c].shortNum+")</span></dd>",b+="</dl>"}return b+="</div></div>"},getBankListSuccess:function(a){var b="";0===a.code?(this.bankList=a.data,b=this.getBankListHtml(this.bankList),this.showBankList(b)):this.getBankListError(a)},getBankListError:function(a){var b=a.msg;b&&""!==b||(b="网络异常，请稍后再试"),this.messageBox.show({msg:b,type:"alert",autoClose:!0})},applyCashSuccess:function(a){0===a.code?window.location.href="point-admin.html":this.applyCashError(a)},showAddBranchMessage:function(){var a={buttons:[],space:{}};a.needMask=!0,a.space={height:100},a.content='<div class="tip-msg-fixed">需补充当前银行卡的开户信息才可以成功提现哦~</div>',a.title="温馨提示",a.buttons.push({text:"立即去完善",css:"save x2",callback:"pointCash.addBranchInfo()"},{text:"取 消",css:"cancel x2",callback:"pointCash.cancelAddBranchInfo()"}),this.popWindow.show(a)},cancelAddBranchInfo:function(){this.popWindow.hide()},addBranchInfo:function(){var a,b,c,d,e=this.selectedBankInfo;a=encodeURIComponent(e.userBankId),b=encodeURIComponent(e.name),d=encodeURIComponent(e.combineName),c=encodeURIComponent(e.bankCardNumA),window.location="point-card-add-card.html?userBankId="+a+"&name="+b+"&bankCardNum="+c+"&combineName="+d},applyCashError:function(a){this.messageBox.show({msg:a.msg,type:"alert",autoClose:!0})},attachEvent:function(){var a=document.querySelector("#chooseBank"),b=document.querySelector("#save");a.addEventListener("click",function(){this.getBankList()}.bind(this),!1),b.addEventListener("click",function(){this.applyCash()}.bind(this),!1)}};pointCash.init();