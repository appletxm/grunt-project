var mockPointList={code:0,msg:"成功",data:[{pageNo:1,pageSize:10,orderBy:null,order:null,result:[{list:[{id:466,type:2,pointLog:"好评积分",integralNum:50,createTime:"07-15",status:1,remark:"可提现"}],stage:"2015-07"},{list:[{id:501,pointLog:"注册并通过身份认证",integralNum:200,createTime:"06-15",status:3,type:4,remark:"已经提现"},{id:503,pointLog:"回复患者咨询",integralNum:100,createTime:"06-12",status:3,type:6,remark:"已经提现"}],stage:"2015-06"}],totalCount:30,totalPages:3,orderBySetted:!1,hasNext:!1,nextPage:1,hasPre:!1,prePage:1,first:0}]},pointList={ajax:null,messageBox:null,removePointList:[],pageInfo:{pageNo:1,pageSize:20},init:function(){this.ajax=new Ajax,this.messageBox=new MessageBox,this.attachEvent(),this.getPointList()},getPointList:function(){var a={sendParameters:{page:this.pageInfo.pageNo,num:this.pageInfo.pageSize}};a.url=SYS_VAR.SERVER_ADDRESS+"doc/point_history/",a.type="GET",a.asyn=!0,a.onSuccess=this.handleGetPointListSuccess.bind(this),a.onError=this.handleGetPointListError.bind(this),a.mssage=this.messageBox,this.ajax.send(a)},handleGetPointListSuccess:function(a){0===a.code?(1===this.pageInfo.pageNo&&this.getPageInfo(a),this.buildPointListHtml(a)):this.handleGetPointListError(a)},getPageInfo:function(a){var b=this.pageInfo;b.totalCount=a.data[0].totalCount,b.totalPages=a.data[0].totalPages},buildPointListHtml:function(a){var b,c,d,e,f=[];if(d=document.querySelector("#point-list"),a.data&&a.data[0].result&&a.data[0].result.length>0){b=a.data[0],c=b.result;for(var g=0;g<c.length;g++){var h,i=c[g].list;h=document.querySelector("#stage_"+c[g].stage),h||f.push('<p class="tip-show-msg" id="stage_'+c[g].stage+'">'+c[g].stage+"</p>");for(var j=0;j<i.length;j++){var k,l,m="&nbsp;",n=parseInt(i[j].type||1,10);(3===i[j].status||"3"===i[j].status)&&(m=i[j].remark),4===n||6===n?(k=' class="need-skip"',l=' onclick="pointList.skipToDetail('+i[j].id+", '"+i[j].pointLog+"','"+i[j].remark+"');\""):(k="",l=""),f.push('<dl id="point_log_'+i[j].id+'"'+k+l+">"),f.push("<dt>"+i[j].pointLog+'<span class="black">'+i[j].integralNum+"</span></dt>"),f.push("<dd><i>"+i[j].createTime+"</i><span>"+m+"</span></dd>"),f.push("</dl>")}}1===this.pageInfo.pageNo?d.innerHTML=f.join(""):(e=document.createElement("span"),e.innerHTML=f.join(""),d.appendChild(e)),document.querySelector("#loadMore").style.display="block"}else 1==this.pageInfo.pageNo&&(d.innerHTML='<p class="no-data-tip no-point-list-tip"></p>')},skipToDetail:function(a,b,c){window.location.href="point-detail.html?point_id="+encodeURIComponent(a)+"&point_log="+encodeURIComponent(b)+"&remark="+encodeURIComponent(c)},handleGetPointListError:function(a){var b=a.msg;b&&""!==b||(b="网络异常，请稍后再试"),this.messageBox.show({msg:b,type:"alert",autoClose:!0})},handleLoadMore:function(){return this.pageInfo.pageNo>=this.pageInfo.totalPages?!1:(this.pageInfo.pageNo+=1,void this.getPointList())},attachEvent:function(){var a=document.querySelector("#loadMore");a.addEventListener("click",function(){this.handleLoadMore()}.bind(this))}};pointList.init();