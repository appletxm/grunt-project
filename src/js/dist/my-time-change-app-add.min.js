var myTimeAppAdd={serverAddress:SYS_VAR.SERVER_ADDRESS,ajax:null,messageBox:null,popWindow:null,currentEditTimeObj:null,timeSlideStartTime:null,timeSlideEndTime:null,readyTimeList:[],workTime:{},init:function(){this.ajax=new Ajax,this.messageBox=new MessageBox,this.timeSlideStartTime=new TimeSlide,this.timeSlideEndTime=new TimeSlide,this.popWindow=new PopWindow,this.timeSlideStartTime.init({triggerTouchObj:document.querySelectorAll("#startTime .slide-panel")[0],width:50,scrollCell:50,fastSkip:5,timeFormat:"00:00",timeStep:5,showTimeSize:5}),this.timeSlideEndTime.init({triggerTouchObj:document.querySelectorAll("#endTime .slide-panel")[0],width:50,scrollCell:50,fastSkip:5,timeFormat:"00:00",timeStep:5,showTimeSize:5}),this.getDoctorTime(),this.attachEvent()},getDoctorTime:function(){var a={sendParameters:{}};a.url=this.serverAddress+"doc/time_list",a.type="GET",a.asyn=!0,a.onSuccess=this.handleGetTimeSuccess.bind(this),a.onError=this.handleError.bind(this),a.mssage=this.msessageBox,this.ajax.send(a)},handleGetTimeSuccess:function(a){(0===a.code||"0"===a.code)&&(this.readyTimeList=a.data[0].cloudWorkTime)},handleError:function(a){var b=a.msg;(b||""===b)&&(b="网络异常，请稍后再试。"),this.messageBox.show({msg:b,type:"alert",autoClose:!0})},handleClick:function(a){var b=a.target,c=b.tagName.toLowerCase();"dt"===c&&(b=b.parentNode),"dd"===c&&(b=b.parentNode),"week"===b.getAttribute("for")?this.showWeekChooseBox():"time"===b.getAttribute("for")&&this.showSetTimeBox(document.querySelector("#timeText")),a.preventDefault()},showWeekChooseBox:function(){var a={buttons:[],space:{}};a.needMask=!0,a.space={height:310},a.title="请选择出诊日期",a.content=this.getWeekendHtml(),a.buttons.push({text:"取 消",css:"cancel x1",callback:"myTimeAppAdd.cancelChooseWeekCallback()"}),this.popWindow.show(a)},showSetTimeBox:function(a){var b,c,d,e;b=/^\d{2}:\d{2}-\d{2}:\d{2}$/.test(a.innerHTML)?a.innerHTML:"00:00-00:00",c=b.split("-"),d=c[0],e=c[1],this.currentEditTimeObj=a,this.timeSlideStartTime.params.timeFormat=d,this.timeSlideEndTime.params.timeFormat=e,this.timeSlideStartTime.getFormat(d),this.timeSlideEndTime.getFormat(e),this.timeSlideStartTime.setDefaultValue(),this.timeSlideEndTime.setDefaultValue(),document.querySelector("#userTimePanel").style.display="block"},handleTimePopClick:function(a){var b=a.target,c=b.tagName.toLowerCase();"a"===c&&b.className.indexOf("close-pop")>=0&&this.hideTimePop(),"input"===c&&b.getAttribute("id").indexOf("resetTime")>=0&&this.resetTimePop(),"input"===c&&b.getAttribute("id").indexOf("keepTime")>=0&&this.setTimeToList()},hideTimePop:function(){document.querySelector("#userTimePanel").style.display="none"},resetTimePop:function(){this.timeSlideStartTime.resetTimePanel(),this.timeSlideEndTime.resetTimePanel()},setTimeToList:function(){var a,b=this.timeSlideStartTime.currentTime,c=this.timeSlideEndTime.currentTime,d=this.currentEditTimeObj,e=b.hours<10?"0"+b.hours:b.hours,f=b.minutes<10?"0"+b.minutes:b.minutes,g=c.hours<10?"0"+c.hours:c.hours,h=c.minutes<10?"0"+c.minutes:c.minutes;return e+":"+f>g+":"+h?(this.messageBox.show({msg:"开始时间不能大于结束时间",type:"alert",autoClose:!0}),!1):(a=e+":"+f+"-"+g+":"+h,this.workTime.workTime=a,d.innerHTML=a,void this.hideTimePop())},getWeekendHtml:function(){var a=[],b=["星期一","星期二","星期三","星期四","星期五","星期六","星期日"];a.push('<ul class="mask-time" style="display: block;">');for(var c=0;7>c;c++)a.push('<li value="'+(c+1)+'" onclick="myTimeAppAdd.selectWeek(event);">'+b[c]+"</li>");return a.push("</ul>"),a.join("")},selectWeek:function(a){var b=a.currentTarget;document.querySelector("#weekText").innerHTML=b.innerHTML,this.workTime.weekIndex=parseInt(b.getAttribute("value"),10),this.cancelChooseWeekCallback()},cancelChooseWeekCallback:function(){this.popWindow.hide()},checkTimeHasBeenAdded:function(){for(var a=this.readyTimeList,b=this.workTime,c=!1,d=0;d<a.length;d++)if(a[d].weekIndex===b.weekIndex&&a[d].work.indexOf(b.workTime)>=0){c=!0;break}return c},doValidate:function(){var a={};return this.workTime.weekIndex?this.workTime.workTime?this.checkTimeHasBeenAdded()?(a.msg="选择的时间点与已经有时间点冲突，请重新选择",a.status=!1,a):{msg:"",status:!0}:(a.msg="请选择出诊时间",a.status=!1,a):(a.msg="请选择出诊日期",a.status=!1,a)},doSaveNewTime:function(){var a,b={sendParameters:{}};return a=this.doValidate(),a.status===!1?(this.messageBox.show({msg:a.msg,type:"alert",autoClose:!0}),!1):(b.sendParameters.sendTime=(new Date).getTime(),b.sendParameters=this.workTime,b.url=this.serverAddress+"doc/add_cloud_time",b.type="GET",b.asyn=!0,b.onSuccess=this.handleSaveTimeSuccess.bind(this),b.onError=this.handleSaveTimeError.bind(this),this.showLoading(),void this.ajax.send(b))},handleSaveTimeSuccess:function(a){0===a.code||"0"===a.code?window.location.href="my-time-change-app.html":this.handleSaveTimeError(a)},handleSaveTimeError:function(a){this.messageBox.show({msg:a.msg||"保存出诊时间失败，请重试",type:"alert",autoClose:!0})},showLoading:function(){this.messageBox.show({msg:'<span class="fa fa-spinner fa-pulse fa-2x fa-fw"></span>',type:"loading",autoClose:!1})},hideLoading:function(){this.messageBox.hide()},attachEvent:function(){var a=document.querySelector("#baiyuTime"),b=document.querySelector("#userTimePanel"),c=document.querySelector("#saveTime");a.addEventListener("click",function(a){this.handleClick(a)}.bind(this)),b.addEventListener("click",function(a){this.handleTimePopClick(a)}.bind(this)),c.addEventListener("click",function(a){this.doSaveNewTime()}.bind(this))}};myTimeAppAdd.init();