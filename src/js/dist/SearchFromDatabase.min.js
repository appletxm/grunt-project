var SearchFromDatabase=function(){this.params={},this.objects={},this.key=null,this.page=1,this.number=10,this.init=function(a){for(var b in a)this.params[b]=a[b];this.createTemplate(),setTimeout(function(){this.getSearchObjects(),this.attachEvent()}.bind(this),10)},this.createTemplate=function(){var a,b=this.params,c=[];a='onsubmit="return '+b.pageObjString+"."+b.searchObjString+'.handleKeyBoardSearch();"',c.push('<div class="form-search">'),c.push("<form "+a+">"),c.push("<span>"),c.push("<i>"+b.tipText+"</i>"),c.push('<input type="search" value="" placeholder="'+b.tipText+'" >'),c.push("</span>"),c.push("</form>"),b.tipList&&(c.push('<div class="search-tip-list-outer" style="display:none;">'),c.push('<div class="form-list search-tip-list" style="display:block;">'),c.push("</div>"),c.push("</div>")),b.bindObj.innerHTML=c.join("")},this.handleSearchPanelClick=function(){var a=this.objects.span,b=this.objects.input;a.className.indexOf("selected")<0&&(a.className="selected",b.style.display="block",b.focus())},this.getSearchObjects=function(){this.objects.input=this.params.bindObj.querySelectorAll("input")[0],this.objects.span=this.params.bindObj.querySelectorAll("span")[0],this.objects.form=this.params.bindObj.querySelectorAll("form")[0],this.params.tipList&&(this.objects.tipOuter=this.params.bindObj.querySelectorAll(".search-tip-list-outer")[0],this.objects.tipList=this.params.bindObj.querySelectorAll(".search-tip-list")[0])},this.handleSearchInput=function(a){var b={sendParameters:{}};return this.key=this.objects.input.value,this.params.tipList?""===this.key.trim()?(this.objects.tipList.innerHTML="",!1):(b.sendParameters.query_str=this.key,b.url=this.params.tipList.action,b.type="GET",b.asyn=!0,b.onSuccess=this.handleSearchInputSuccess.bind(this),b.onError=this.handleGetError.bind(this),this.objects.tipList.innerHTML='<span class="fa fa-spinner fa-pulse fa-2x fa-fw"></span>',this.objects.tipOuter.className="search-tip-list-outer  actived",this.params.tipList.mockData?this.handleSearchInputSuccess(this.params.tipList.mockData):this.params.ajax.send(b),void a.preventDefault()):!1},this.handleSearchInputSuccess=function(a){var b="",c=[],d=this.objects.tipOuter;if(d.className="search-tip-list-outer",0===a.code)if(c=a.data,c&&c.length>0){for(var e=0;e<c.length;e++)b+='<a href="javascript:void(0);" id="'+c[e]+'">'+c[e]+"</a>";this.objects.tipList.innerHTML=b,d.style.display="block"}else this.hideTipList();else this.handleGetError(a)},this.handleGetError=function(a){var b=a.msg;this.hideTipList(),a.msg&&""!==a.msg||(b="网络异常，请稍后再试"),this.params.messageBox.show({msg:b,type:"alert",autoClose:!0})},this.handleSearchTipList=function(a){var b=a.target,c=b.tagName.toLowerCase();"a"===c&&(this.key=b.getAttribute("id").trim(),this.objects.input.value=this.key,this.handleDoSearch())},this.handleDoSearch=function(){return this.key=this.objects.input.value,""==this.key.trim()?(this.messageBox.show({msg:"请输入搜索关键字",type:"alert",autoClose:!0}),!1):(this.objects.input.blur(),this.params.beforeSearchFunction&&this.params.beforeSearchFunction(),this.params.callback&&this.params.callback(this.key),void this.hideTipList())},this.handleKeyBoardSearch=function(){try{this.handleDoSearch()}catch(a){return!1}return!1},this.handleBlur=function(a){var b=a.currentTarget,c=b.parentNode;b.value&&""!==b.value||(c.className="")},this.hideTipList=function(){this.objects.tipList.innerHTML="",this.objects.tipOuter.className="search-tip-list-outer",this.objects.tipOuter.style.display="none"},this.attachEvent=function(){this.params.bindObj.addEventListener("click",function(){this.handleSearchPanelClick()}.bind(this)),this.objects.input.addEventListener("input",function(){this.handleSearchInput(event)}.bind(this)),this.objects.input.addEventListener("blur",function(){this.handleBlur(event)}.bind(this)),this.params.tipList&&this.objects.tipList.addEventListener("click",function(a){this.handleSearchTipList(a)}.bind(this))}};