var mockDetail={code:0,msg:"success",data:[{userId:11,name:"张医生",gender:"女",phone:"13212345678",title:"主院医师",department:"神经内科",hospital:"南方医院",introduction:"这是医生的简介",expertise:"确认修改信息了啊"}]},mockSummary={code:0,msg:"",data:[{name:"唐唐",department:"儿科",title:"医师",photoUrl:"../../styles/images/dor_header.png"}]},mockQr={code:0,msg:"",data:[{doctor_qrurl:"../../styles/images/code.png",patient_qrurl:"../../styles/images/code.png"}]},myCode={ajax:null,messageBox:null,wxSDK:null,personalInfo:{},currentPageIndex:0,pageMax:2,touchInfo:{start:{pageX:null},end:{pageX:null}},init:function(){this.ajax=new Ajax,this.messageBox=new MessageBox,this.wxSDK=new WeixinSDK,this.showLoading(),this.wxSDK.init({debug:null,errorCallback:this.getVerificationInfo.bind(this),successCallback:this.getVerificationInfo.bind(this),jsApiList:["onMenuShareTimeline","onMenuShareAppMessage"],ajax:this.ajax}),this.attachEvent()},getVerificationInfo:function(){var a={sendParameters:{}};a.url=SYS_VAR.SERVER_ADDRESS+"doc/user_auth_data/",a.type="GET",a.asyn=!0,a.onSuccess=this.handleGetInfoSuccess.bind(this),a.onError=this.handleError.bind(this),this.ajax.send(a)},handleGetInfoSuccess:function(a){0===a.code?(this.personalInfo=a.data[0],a.data[0].photoUrl&&""!==a.data[0].photoUrl||(this.personalInfo.photoUrl=SYS_VAR.STATIC_ADDRESS+"/styles/images/dor_header.png"),this.getMyInformation()):this.handleError(a)},getMyInformation:function(){var a={sendParameters:{}};a.url=SYS_VAR.SERVER_ADDRESS+"doc/get_info/",a.type="GET",a.asyn=!0,a.onSuccess=this.handleGetMyInformationSuccess.bind(this),a.onError=this.handleError.bind(this),this.ajax.send(a)},handleGetMyInformationSuccess:function(a){if(0===a.code&&a.data&&a.data.length>0){var b=a.data[0];for(var c in b)this.personalInfo[c]||(this.personalInfo[c]=b[c]);this.showDoctorInfo(this.personalInfo),this.getQRCode()}},showDoctorInfo:function(a){var b,c=[];b=a.photoUrl&&""!==a.photoUrl&&"null"!==a.photoUrl&&"undefined"!==a.photoUrl?'<img src="'+a.photoUrl+'" />':'<img src="../../../../styles/images/dor_header.png" />',c.push(b),c.push('<h1 for="qrTitle">'+(a.name||"")+"</h1>"),c.push('<span for="qrDepartment">'+(a.department||"")+"</span>"),c.push('<span for="qrLevel">'+(a.title||"")+"</span>"),c.push("<i>"+(a.hospital||"")+"</i>");for(var d=document.querySelectorAll(".doctor-info"),e=0;e<d.length;e++)d[e].innerHTML=c.join("")},getQRCode:function(){var a={sendParameters:{}};a.url=SYS_VAR.SERVER_ADDRESS+"doc/emit_qrcode/",a.type="GET",a.asyn=!0,a.onSuccess=this.handleGetQRSuccess.bind(this),a.onError=this.handleError.bind(this),this.ajax.send(a)},handleGetQRSuccess:function(a){0===a.code?(document.querySelector("#doctor_qr").innerHTML='<img src="'+a.data[0].doctor_qrurl+'"/><p class="tip-show-msg">使用微信扫一扫进行绑定</p>',document.querySelector("#patient_qr").innerHTML='<img src="'+a.data[0].patient_qrurl+'"/><p class="tip-show-msg">使用微信扫一扫进行绑定</p>',this.personalInfo.doctor_qrurl=a.data[0].doctor_qrurl,this.personalInfo.patient_qrurl=a.data[0].patient_qrurl,this.generateShareData(),this.hideLoading()):this.handleError(a)},handleError:function(a){var b=a.msg;this.hideLoading(),b&&""!==b||(b="网络异常，请稍后重试"),this.messageBox.show({msg:b,type:"alert",autoClose:!0})},showLoading:function(){this.messageBox.show({msg:'<span class="fa fa-spinner fa-pulse fa-2x fa-fw"></span>',type:"loading",autoClose:!1})},hideLoading:function(){this.messageBox.hide()},handleStart:function(a){this.touchInfo.start.pageX=a.pageX||a.touches[0].pageX,a.preventDefault(),a.stopPropagation()},handleMove:function(a){this.touchInfo.end.pageX=a.pageX||a.touches[0].pageX,a.preventDefault(),a.stopPropagation()},handleEnd:function(a){var b=1,c=this.touchInfo.start.pageX,d=this.touchInfo.end.pageX;null!==d&&(b=c>d?1:d>c?0:null,this.handleScroll(b),this.generateShareData(),a.preventDefault(),a.stopPropagation())},handleScroll:function(a){var b,c=document.querySelectorAll(".code-panel"),d=document.querySelectorAll(".dot li"),e="-150%",f=300;b=this.currentPageIndex,1===a?this.currentPageIndex++:(e="150%",this.currentPageIndex--),this.currentPageIndex>=this.pageMax&&(this.currentPageIndex=0),this.currentPageIndex<0&&(this.currentPageIndex=this.pageMax-1);for(var g=0;g<c.length;g++)g!==b&&(c[g].style.left=a?"150%":"-150%");setTimeout(function(){c[b].className=c[b].className+" animate",c[b].style.left=e,setTimeout(function(){c[b].className=c[b].className.replace(/\s{1}animate/g,""),c[b].style.left=a?"150%":"-150%"}.bind(this),f),c[this.currentPageIndex].className=c[this.currentPageIndex].className+" animate",c[this.currentPageIndex].style.left="50%",this.touchInfo.start.pageX=null,this.touchInfo.end.pageX=null}.bind(this),0),d[b].className="",d[this.currentPageIndex].className="selected"},generateShareData:function(){var a,b,c,d,e;e=this.personalInfo.name.indexOf("医生")>=0?this.personalInfo.name:this.personalInfo.name+"医生",d="?name="+encodeURIComponent(e),d+="&department="+encodeURIComponent(this.personalInfo.department),d+="&title="+encodeURIComponent(this.personalInfo.title),d+="&hospital="+encodeURIComponent(this.personalInfo.hospital),d+="&photoUrl="+encodeURIComponent(this.personalInfo.photoUrl),1===this.currentPageIndex?(d+="&type=doctor",d+="&codeImg="+encodeURIComponent(this.personalInfo.doctor_qrurl),c="推荐您使用大白云诊，开启移动医疗之旅！"):(d+="&type=patient",d+="&codeImg="+encodeURIComponent(this.personalInfo.patient_qrurl),c="你好，我是"+e+"！欢迎关注我的大白云诊公众号，以便为你提供一对一诊疗服务。"),a="大白云诊邀请函",b=SYS_VAR.STATIC_ADDRESS+"/templates/my/my-code-share.html"+d,wx.onMenuShareTimeline({title:a,desc:c,link:b,imgUrl:this.personalInfo.photoUrl}),wx.onMenuShareAppMessage({title:a,desc:c,link:b,imgUrl:this.personalInfo.photoUrl})},attachEvent:function(){var a=document.querySelector("#myCode");a.addEventListener("touchstart",function(a){this.handleStart(a)}.bind(this)),a.addEventListener("touchmove",function(a){this.handleMove(a)}.bind(this)),a.addEventListener("touchend",function(a){this.handleEnd(a)}.bind(this))}};myCode.init();