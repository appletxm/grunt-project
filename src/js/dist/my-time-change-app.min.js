var myTimeApp={serverAddress:SYS_VAR.SERVER_ADDRESS,ajax:null,messageBox:null,deleteTimeList:[],init:function(){this.ajax=new Ajax,this.messageBox=new MessageBox,this.getDoctorTime(),this.attachEvent()},getDoctorTime:function(){var a={sendParameters:{}};a.url=this.serverAddress+"doc/time_list",a.type="GET",a.asyn=!0,a.onSuccess=this.handleGetTimeSuccess.bind(this),a.onError=this.handleError.bind(this),this.showLoading(),this.ajax.send(a)},handleGetTimeSuccess:function(a){0===a.code||"0"===a.code?(this.showHospitalTime(a.data[0]),this.hideLoading()):this.handleError(a)},handleError:function(a){var b=a.msg;(b||""===b)&&(b="网络异常，请稍后再试。"),this.messageBox.show({msg:b,type:"alert",autoClose:!0})},handleClick:function(a){var b=a.target,c=b.tagName.toLowerCase();"span"===c&&this.toggleSelectedTime(b),a.preventDefault()},toggleSelectedTime:function(a){var b=this.deleteTimeList,c=a.getAttribute("forWeek"),d={},e=-1;b.forEach(function(a,b){return a[c]?(e=b,!1):void 0}),-1===e?(d[c]=a.innerHTML,a.className=a.className+" checked",b.push(d)):(b.splice(e,1),a.className=a.className.replace(" checked",""))},showHospitalTime:function(a){var b=document.querySelectorAll("#baiyuTime dd"),c=a.cloudWorkTime;c.forEach(function(a){var c,d=parseInt(a.weekIndex,10)-1,e=b[d],f=[];if(a.work&&""!==a.work&&"null"!==a.work&&"undefined"!==a.work){if(c=(a.work||"").split(";"),c.length>0){for(var g=0;g<c.length;g++)f.push('<span class="check-input" forWeek="'+d+"_"+g+'">'+c[g]+"</span>");e.innerHTML=f.join("")}}else a.work="",e.innerHTML=""}),c.length>0&&(document.querySelector("#deleteSelectedTime").style.display="block")},deleteSelectedTime:function(){var a,b=this.deleteTimeList,c={sendParameters:{}};return b.length<=0?(this.messageBox.show({msg:"请选择要删除的时间点",type:"alert",autoClose:!0}),!1):(a=this.getSaveWorks(),c.sendParameters.works=encodeURIComponent(JSON.stringify(a)),c.url=this.serverAddress+"doc/edit_cloud_time",c.type="GET",c.asyn=!0,c.onSuccess=this.handleSaveTimeSuccess.bind(this),c.onError=this.handleSaveTimeError.bind(this),this.showLoading(),void this.ajax.send(c))},getSaveWorks:function(){var a,b=[];a=document.querySelectorAll("#baiyuTime dd");for(var c=0;c<a.length;c++){var d=parseInt(a[c].getAttribute("forWeek"),10)+1,e=[],f=a[c].querySelectorAll('span[class$="input"]');if(f.length>0){for(var g=0;g<f.length;g++)e.push(f[g].innerHTML);b.push({weekIndex:d,work:e.join(";")})}}return b},handleSaveTimeSuccess:function(a){0===a.code||"0"===a.code?(this.deleteTimeList=[],window.location.reload()):this.handleSaveTimeError(a)},handleSaveTimeError:function(a){this.messageBox.show({msg:a.msg||"删除出诊时间失败，请重试",type:"alert",autoClose:!0})},addNewWorkTime:function(){window.location.href="my-time-change-app-new.html"},showLoading:function(){this.messageBox.show({msg:'<span class="fa fa-spinner fa-pulse fa-2x fa-fw"></span>',type:"loading",autoClose:!1})},hideLoading:function(){this.messageBox.hide()},attachEvent:function(){var a=document.querySelector("#baiyuTime"),b=document.querySelector("#addNewTime"),c=document.querySelector("#deleteSelectedTime");a.addEventListener("click",function(a){this.handleClick(a)}.bind(this)),b.addEventListener("click",function(){this.addNewWorkTime()}.bind(this)),c.addEventListener("click",function(){this.deleteSelectedTime()}.bind(this))}};myTimeApp.init();