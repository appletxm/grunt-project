var SkipPage=function(){this.configs={},this.isFirstLoad=!0,this.isGettingData=!1,this.originalOnSuccess=null,this.originalOnError=null,this.skipPosition=0,this.init=function(a){this.configs=a,this.originalOnSuccess=this.configs.param.onSuccess,this.originalOnError=this.configs.param.onError,this.configs.param.onError=this.onError.bind(this),this.configs.param.onSuccess=this.onSuccess.bind(this),this.loadData(this.configs.param),this.attachEvent()},this.loadData=function(a){this.isFirstLoad===!1&&this.starAnimate(),this.isGettingData=!0,this.configs.ajax.send(a)},this.onSuccess=function(a){0===a.code||"0"===a.code?(this.setPageInfo(a),this.originalOnSuccess&&this.originalOnSuccess(a),this.endAnimate()):this.onError(a),this.isGettingData=!1},this.setPageInfo=function(a){var b;b=this.configs.isSelfInterface===!0?a.data[2]:a.data[0],this.configs.pageInfo.totalCount=b.totalCount||0,this.configs.pageInfo.totalPage=b.totalPage||0,this.configs.pageInfo.pageNo=0|b.pageNo,this.configs.param.sendParameters.page=b.pageNo||0},this.onError=function(a){this.originalOnError&&this.originalOnError(a),this.isGettingData=!1},this.handleScroll=function(a){var b=this.configs.scrollObj||document.querySelectorAll("body")[0];return this.isFirstLoad===!0?!1:this.isGettingData===!0?!1:b.scrollTop<=0&&this.configs.needSkipPrev?(this.loadPreviousPage(),!1):b.scrollTop>=b.scrollHeight-b.clientHeight&&this.configs.needSkipNext?(this.loadNextPage(),!1):void 0},this.loadPreviousPage=function(){var a=this.configs.pageInfo;a.pageNo===this.configs.pageInfo.totalPage||(this.configs.param.sendParameters.page++,this.skipPosition=0,this.loadData(this.configs.param))},this.loadNextPage=function(){var a=this.configs.pageInfo;a.pageNo===this.configs.pageInfo.totalPage||(this.configs.param.sendParameters.page++,this.skipPosition=1,this.loadData(this.configs.param))},this.appendHtmlNode=function(a,b,c){var d;d=document.createElement("span"),d.setAttribute("id","page_"+c),d.innerHTML=a,1===this.skipPosition||this.isFirstLoad===!0?b.appendChild(d):0===this.skipPosition&&(b.childNodes&&b.childNodes.length>=1?b.insertBefore(d,b.childNodes[0]):b.appendChild(d)),setTimeout(function(){this.doScroll(),this.isFirstLoad=!1}.bind(this),0)},this.doScroll=function(){var a,b,c=this.configs.scrollObj||document.querySelectorAll("body")[0],d=(this.configs.scrollObj||c).scrollTop,e=10;return this.isFirstLoad===!0?(c.scrollTop=c.scrollHeight-document.documentElement.clientHeight-e,!1):(a=document.querySelector("#page_"+this.configs.pageInfo.pageNo),b=window.getComputedStyle(a,null).height,b&&"auto"!==b||(b=a.getBoundingClientRect().height),1===this.skipPosition?d=d-(b||e)+e:0===this.skipPosition&&(d=d+(b||e)-e),void(c.scrollTop=d))},this.starAnimate=function(){var a=this.configs.messageBox,b='<span class="fa fa-spinner fa-pulse fa-2x fa-fw"></span>数据加载...';a&&a.show({msg:b,type:"loading",autoClose:!1})},this.endAnimate=function(){var a=this.configs.messageBox;a&&a.hide()},this.attachEvent=function(){var a=this.configs.scrollObj||window;a.addEventListener("scroll",function(a){this.handleScroll(a)}.bind(this))}};