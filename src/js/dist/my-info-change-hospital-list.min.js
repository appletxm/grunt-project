var hospitalData={code:0,msg:"",data:[{id:1,name:"中国医院"},{id:2,name:"中国医院内容"},{id:3,name:"每家用医院大院好用的东西"},{id:4,name:"是一家美容院"}]},myInfoChangeHospitalList={ajax:null,messageBox:null,searchFromCache:null,popWindow:null,urlParams:{},hospitalList:[],selectedHospitalId:null,init:function(){this.ajax=new Ajax,this.messageBox=new MessageBox,this.popWindow=new PopWindow,this.searchFromCache=new SearchFromCache,this.attachEvent(),this.getHospitalList()},getHospitalList:function(){this.urlParams=window.location.search.getValueFromUrl(),document.querySelector("#hospital_list").innerHTML='<a class="selected">'+decodeURIComponent(this.urlParams.name)+"</a>";var a={sendParameters:{cityId:this.urlParams.cityId}};a.url=SYS_VAR.SERVER_ADDRESS+"doc/hospital_list/",a.type="GET",a.asyn=!0,a.onSuccess=this.handleGetHospitalListSuccess.bind(this),a.onError=this.handleError.bind(this),a.mssage=this.messageBox,this.ajax.send(a)},handleGetHospitalListSuccess:function(a){var b=document.querySelector("#hospital_list"),c=b.innerHTML;0===a.code?(this.hospitalList=a.data,b.innerHTML=c+this.getHospitalListHtml(this.hospitalList)):this.handleError(a)},getHospitalListHtml:function(a){for(var b="",c=0;c<a.length;c++)b+='<a onclick="myInfoChangeHospitalList.selectHospitalFromList(event)" value="'+a[c].id+'">'+a[c].name+"</a>";return b+='<a onclick="myInfoChangeHospitalList.addNewHospital();">其他</a>'},selectHospitalFromList:function(a){this.doSave(a.target.getAttribute("value"))},doSave:function(a,b){var c={sendParameters:{hospitalId:a}};b&&(c.sendParameters.cityId=b,c.sendParameters.hospitalId=0,c.sendParameters.hospitalName=a),c.url=SYS_VAR.SERVER_ADDRESS+"doc/info_update/",c.type="GET",c.asyn=!0,c.onSuccess=this.handleSaveSuccess.bind(this),c.onError=this.handleError.bind(this),c.mssage=this.messageBox,this.ajax.send(c)},handleSaveSuccess:function(a){0===a.code?window.location.href="my-information.html":this.handleError(a)},handleError:function(a){var b=a.msg;b&&""!==b||(b="网络异常，请稍后重试!"),this.messageBox.show({msg:b,type:"alert",autoClose:!0})},addNewHospital:function(){var a={popWindow:this.popWindow,title:"输入医院名称",placeHolder:"请输入医院名称",pageJSObjName:"myInfoChangeHospitalList",pageJSObj:myInfoChangeHospitalList,cacheDataList:this.hospitalList,okCallBack:this.doSaveNewHospital.bind(this),cancelCallBack:this.cancelNewHospitalCallback.bind(this),selectedTipListCallback:this.selectSearchItem.bind(this),messageBox:this.messageBox,errorMsg:"请输入正确的医院名称"};this.searchFromCache.showSearchBox(a)},selectSearchItem:function(a){this.selectedHospitalId=a},doSaveNewHospital:function(a){this.selectedHospitalId?this.doSave(this.selectedHospitalId):this.doSave(a,this.urlParams.cityId),this.selectedHospitalId=null},cancelNewHospitalCallback:function(){},attachEvent:function(){}};myInfoChangeHospitalList.init();